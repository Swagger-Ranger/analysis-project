"use strict";(self.webpackChunkanalytic_project=self.webpackChunkanalytic_project||[]).push([[2498],{8639:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>o});var c=s(4848),r=s(8453);const l={title:"JVM\u6570\u636e\u5206\u6790",sidebar_position:3,toc_min_heading_level:2,toc_max_heading_level:5},i=void 0,a={id:"DevOps/JVM\u6570\u636e\u5206\u6790",title:"JVM\u6570\u636e\u5206\u6790",description:"\u5206\u6790\u5806\u5185\u5b58\u6570\u636e",source:"@site/docs/DevOps/JVM\u6570\u636e\u5206\u6790.mdx",sourceDirName:"DevOps",slug:"/DevOps/JVM\u6570\u636e\u5206\u6790",permalink:"/analysis-project/docs/DevOps/JVM\u6570\u636e\u5206\u6790",draft:!1,unlisted:!1,editUrl:"https://github.com/Swagger-Ranger/analysis-project/docs/DevOps/JVM\u6570\u636e\u5206\u6790.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"JVM\u6570\u636e\u5206\u6790",sidebar_position:3,toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"devopsSidebar",previous:{title:"Linux\u7cfb\u7edf\u63a2\u6d4b\u5de5\u5177",permalink:"/analysis-project/docs/DevOps/Linux\u7cfb\u7edf\u63a2\u6d4b\u5de5\u5177"},next:{title:"Harbor",permalink:"/analysis-project/docs/DevOps/Harbor\u624b\u518c"}},d={},o=[{value:"\u5206\u6790\u5806\u5185\u5b58\u6570\u636e",id:"\u5206\u6790\u5806\u5185\u5b58\u6570\u636e",level:3},{value:"\u5b9e\u6218\u793a\u4f8b",id:"\u5b9e\u6218\u793a\u4f8b",level:4},{value:"\u5206\u6790metaspace\u6570\u636e",id:"\u5206\u6790metaspace\u6570\u636e",level:3},{value:"\u5206\u6790\u7c7b\u52a0\u8f7d\u7684\u6570\u636e",id:"\u5206\u6790\u7c7b\u52a0\u8f7d\u7684\u6570\u636e",level:4},{value:"Metaspace OOM",id:"metaspace-oom",level:4},{value:"\u5206\u6790gc\u65e5\u5fd7",id:"\u5206\u6790gc\u65e5\u5fd7",level:3},{value:"-XX:+UseSerialGC",id:"-xxuseserialgc",level:4},{value:"-XX:+UseG1GC",id:"-xxuseg1gc",level:4}];function t(e){const n={blockquote:"blockquote",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h3,{id:"\u5206\u6790\u5806\u5185\u5b58\u6570\u636e",children:"\u5206\u6790\u5806\u5185\u5b58\u6570\u636e"}),"\n",(0,c.jsxs)(n.p,{children:["\u4f7f\u7528",(0,c.jsx)(n.code,{children:"VisualVM"}),"\u8bca\u65ad\u5de5\u5177\u5206\u6790jvm\u5185\u5b58\u6ea2\u51fa"]}),"\n",(0,c.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,c.jsx)("img",{src:"/analysis-project/img/jvm/jvm-5.png",alt:"image",style:{maxWidth:"82%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,c.jsxs)(n.p,{children:["\u4e0a\u56fe\u662f\u4e00\u4e2a",(0,c.jsx)(n.code,{children:"VisualVM"}),"\u6253\u5f00",(0,c.jsx)(n.code,{children:"dump"}),"\u6587\u4ef6\u540e\u9009\u62e9\u5bf9\u8c61\u89c6\u56fe\u7684\u6837\u5b50\uff0c\u4e00\u904d\u5206\u6790\u6f5c\u5728\u7684\u5185\u5b58\u6cc4\u6f0f\u5c31\u901a\u8fc7\u6b64\u5206\u6790\u3002"]}),"\n",(0,c.jsx)(n.p,{children:"\u5bf9\u5e94\u7684\u56db\u5217\u542b\u4e49\u5982\u4e0b\uff1a"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Name"}),"\uff1a\u5bf9\u8c61\u7684\u7c7b\u540d\uff0c\u8bc6\u522b\u5bf9\u8c61\u7c7b\u578b\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Count"}),"\uff1a\u5bf9\u8c61\u5b9e\u4f8b\u7684\u6570\u91cf\uff0c\u5224\u65ad\u662f\u5426\u6709\u8fc7\u591a\u5b9e\u4f8b\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Size"}),"\uff1a\u6240\u6709\u5b9e\u4f8b\u5360\u7528\u7684\u603b\u5185\u5b58\uff0c\u8bc4\u4f30\u5185\u5b58\u6d88\u8017\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Retained"}),"\uff1a\u5220\u9664\u5bf9\u8c61\u53ef\u4ee5\u91ca\u653e\u7684\u5185\u5b58\u91cf\uff0c\u8bc6\u522b\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\u3002-- \u8fd9\u4e2a\u662f\u4e2a\u5173\u952e\u6307\u6807\uff0c\u5c31\u662f\u6b64\u5bf9\u8c61\u5bfc\u81f4\u4e0d\u80fd\u88ab\u56de\u6536\u7684\u5bf9\u8c61\u6709\u591a\u5c11"]}),"\n"]}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsx)(n.p,{children:"Retained Size \u7684\u8ba1\u7b97\uff1a"}),"\n",(0,c.jsx)(n.p,{children:"\u901a\u8fc7\u5206\u6790\u5bf9\u8c61\u56fe\uff08object graph\uff09\u5e76\u786e\u5b9a\u5728\u5220\u9664\u67d0\u4e2a\u5bf9\u8c61\u540e\u54ea\u4e9b\u5bf9\u8c61\u5c06\u4e0d\u53ef\u8fbe\uff08\u5373\u6210\u4e3a\u5783\u573e\uff09\uff0c\u90a3\u6b64\u5bf9\u8c61\u672c\u8eab\u52a0\u4e0a\u5176\u5220\u9664\u4e4b\u540e\u7684\u90a3\u4e9b\u4e0d\u53ef\u8fbe\u5bf9\u8c61\u6240\u5360\u7528\u7684\u7a7a\u95f4\u5927\u5c0f\u5c31\u662fRetained Size\u3002"}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u88ab\u591a\u4e2a\u6d3b\u8dc3\u5bf9\u8c61\u5f15\u7528\uff0c\u90a3\u4e48\u5b83\u7684\u5927\u5c0f\u4e0d\u4f1a\u88ab\u8ba1\u5165\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61\u7684 Retained Size\uff0c\u53ea\u6709\u5f53\u5bf9\u8c61\u88ab\u5220\u9664\u540e\u4e0d\u53ef\u8bbf\u95ee\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u88ab\u8ba1\u7b97\u4e3a Retained Size\u3002VisualVM \u5185\u5b58\u5206\u6790\u5de5\u5177\u4f7f\u7528\u8fd9\u4e2a\u6982\u5ff5\u6765\u5e2e\u52a9\u5206\u6790\u54ea\u4e9b\u5bf9\u8c61\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\uff1a\u5982\u679c\u67d0\u4e2a\u5bf9\u8c61\u7684 ",(0,c.jsx)(n.strong,{children:"Retained Size"})," \u5f88\u5927\uff0c\u4f46 ",(0,c.jsx)(n.strong,{children:"Size"})," \u5f88\u5c0f\uff0c\u8bf4\u660e\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u94fe\u5f88\u957f\u4e14\u91cd\u8981\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsxs)(n.em,{children:["\u4e0a\u9762\u7684",(0,c.jsx)(n.code,{children:"Class Filter"}),"\u53ef\u4ee5\u8fc7\u6ee4\u51fa\u60f3\u8981\u770b\u7684\u7c7b\u3002"]})}),"\n",(0,c.jsxs)(n.p,{children:["\u7136\u540e\u56e0\u4e3a\u540c\u4e00\u79cd\u5bf9\u8c61\u5728\u4e0d\u540c\u7684\u4f4d\u7f6e\u7684size\u548cretiained\u90fd\u662f\u5728VisualVM\u5408\u5e76\u5c55\u793a\u7684\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u770b\u662f\u54ea\u4e9b\u5bf9\u8c61\u5f15\u7528\u4e86\u8fd9\u4e2a\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u4e0a\u56fe\u4e2d\u4e0b\u65b9\u7684",(0,c.jsx)(n.code,{children:"References"}),"\u5c31\u662f\u770b\u5177\u4f53\u54ea\u4e9b\u5730\u65b9\u5728\u5f15\u7528\u8fd9\u4e9b\u5bf9\u8c61\uff0c\u5176\u5c55\u793a\u7684",(0,c.jsx)(n.code,{children:"reference"}),"\u5b57\u7b26\u7684\u542b\u4e49\u5982\u4e0b\uff1a"]}),"\n",(0,c.jsxs)(n.p,{children:["\u6bd4\u5982",(0,c.jsx)(n.code,{children:"java.util.concurrent.ConcurrentHashMap$Node#479 1 (0%)"})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"java.util.concurrent.ConcurrentHashMap$Node"})}),"\uff1a\u5bf9\u8c61\u7684\u7c7b\u540d\uff0c\u8868\u793a\u8fd9\u4e2a\u5bf9\u8c61\u662f ",(0,c.jsx)(n.code,{children:"ConcurrentHashMap"})," \u5185\u90e8\u7684\u4e00\u4e2a\u9759\u6001\u7c7b ",(0,c.jsx)(n.code,{children:"Node"})," \u7684\u5b9e\u4f8b\u3002",(0,c.jsxs)(n.em,{children:["\uff08  ",(0,c.jsx)(n.code,{children:"ConcurrentHashMap"})," \u7684\u5b9e\u73b0\u4e2d\uff0c",(0,c.jsx)(n.code,{children:"Node"})," \u662f\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u901a\u5e38\u7528\u4e8e\u8868\u793a\u4e00\u4e2a\u94fe\u8868\u8282\u70b9\uff0c\u5305\u542b\u952e\u503c\u5bf9\u548c\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488\u3002\uff09"]})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"#479"})}),"\uff1a\u5bf9\u8c61\u7684\u54c8\u5e0c\u7801\uff08",(0,c.jsx)(n.code,{children:"hash code"}),"\uff09\u7684\u5341\u8fdb\u5236\u5f62\u5f0f\u8868\u793a\uff0c\u7531 ",(0,c.jsx)(n.code,{children:"Object"})," \u7c7b\u7684 ",(0,c.jsx)(n.code,{children:"hashCode()"})," \u65b9\u6cd5\u751f\u6210\u3002\u5728 VisualVM \u4e2d\uff0c\u54c8\u5e0c\u7801\u7528\u4e8e\u552f\u4e00\u6807\u8bc6\u5185\u5b58\u4e2d\u67d0\u4e2a\u5bf9\u8c61\u7684\u5b9e\u4f8b\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"1"})}),"\uff1a\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6570\u91cf\uff0c\u8868\u793a\u5f53\u524d\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6570\u91cf\u662f ",(0,c.jsx)(n.code,{children:"1"}),"\uff0c\u5373\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c",(0,c.jsx)(n.code,{children:"1"})," \u8868\u793a\u5728\u5185\u5b58\u4e2d\u53ea\u6709\u4e00\u4e2a\u8be5\u7c7b\u578b\u7684\u5bf9\u8c61\u5b9e\u4f8b\u88ab\u5f15\u7528\u5230\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"(0%)"})}),"\uff1a\u5bf9\u8c61\u5360\u7528\u7684\u5185\u5b58\u6bd4\u4f8b\uff0c",(0,c.jsx)(n.code,{children:"(0%)"})," \u8868\u793a\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5b9e\u4f8b\u6240\u5360\u7528\u7684\u5185\u5b58\u975e\u5e38\u5c11\uff0c\u76f8\u5bf9\u4e8e\u6240\u6709\u5185\u5b58\u4e2d\u5bf9\u8c61\u7684\u5360\u6bd4\u4e3a ",(0,c.jsx)(n.code,{children:"0%"}),"\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u5185\u5b58\u6cc4\u6f0f\u7684\u7279\u70b9\uff1a\u5f53size\u672c\u8eab\u4e0d\u5927\u800c\u5360\u7528\u91cfRetained\u5374\u5f88\u5927\u65f6\uff0c\u5f80\u5f80\u5c31\u662f\u5185\u5b58\u6cc4\u6f0f\u7684\u5e38\u89c1\u73b0\u8c61\u3002"}),"\n",(0,c.jsx)(n.h4,{id:"\u5b9e\u6218\u793a\u4f8b",children:"\u5b9e\u6218\u793a\u4f8b"}),"\n",(0,c.jsx)(n.p,{children:"\u8fd0\u884c\u5982\u4e0b\u4ee3\u7801\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-java",children:'import java.util.concurrent.LinkedBlockingQueue;\nimport java.util.concurrent.ThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * @author liufei\n * \u6d4b\u8bd5threadLocal\u5185\u5b58\u6cc4\u6f0f\n * 01:\u56fa\u5b9a6\u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u6301\u6709\u4e00\u4e2a\u53d8\u91cf\n * \u6309\u7406\u6765\u8bf4\u4f1a\u6709 6 * 5 = 30M\u5185\u5b58\u65e0\u6cd5\u56de\u6536\uff0c\u5176\u4f59\u7684\u5728set\u65b9\u6cd5\u4e2d\u8986\u76d6\u4e86\u3002\n */\npublic class ThreadLocalOutOfMemoryTest {\n    static class LocalVariable {\n        //\u603b\u5171\u67095M\n        private byte[] locla = new byte[1024 * 1024 * 5];\n    }\n\n    // (1)\u521b\u5efa\u4e86\u4e00\u4e2a\u6838\u5fc3\u7ebf\u7a0b\u6570\u548c\u6700\u5927\u7ebf\u7a0b\u6570\u4e3a 6 \u7684\u7ebf\u7a0b\u6c60\uff0c\u8fd9\u4e2a\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u6c60\u91cc\u9762\u968f\u65f6\u90fd\u6709 6 \u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\n    final static ThreadPoolExecutor poolExecutor =\n            new ThreadPoolExecutor(6, 6, 1, TimeUnit.MINUTES, new LinkedBlockingQueue<>());\n    // (2)\u521b\u5efa\u4e86\u4e00\u4e2a ThreadLocal \u7684\u53d8\u91cf\uff0c\u6cdb\u578b\u53c2\u6570\u4e3a LocalVariable\uff0cLocalVariable \u5185\u90e8\u662f\u4e00\u4e2a Long \u6570\u7ec4\n    static       ThreadLocal<LocalVariable> localVariable = new ThreadLocal<>();\n\n    public static void main(String[] args) throws InterruptedException {\n        // (3)\u5411\u7ebf\u7a0b\u6c60\u91cc\u9762\u653e\u5165 50 \u4e2a\u4efb\u52a1\n        for (int i = 0; i < 50; ++i) {\n            poolExecutor.execute(new Runnable() {\n                @Override\n                public void run() {\n                    // (4) \u5f80threadLocal\u53d8\u91cf\u8bbe\u7f6e\u503c\n                    LocalVariable localVariable = new LocalVariable();\n                    // \u4f1a\u8986\u76d6\n                    ThreadLocalOutOfMemoryTest.localVariable.set(localVariable);\n                    // (5) \u624b\u52a8\u6e05\u7406ThreadLocal\n                    System.out.println("thread name end\uff1a" + Thread.currentThread().getName() + ", value:" + ThreadLocalOutOfMemoryTest.localVariable.get());\n                    // ThreadLocalOutOfMemoryTest.localVariable.remove();\n\n                }\n            });\n\n            Thread.sleep(1000);\n        }\n\n        // (6)\u662f\u5426\u8ba9key\u5931\u6548\uff0c\u90fd\u4e0d\u5f71\u54cd\u3002\u53ea\u8981\u6301\u6709\u7684\u7ebf\u7a0b\u5b58\u5728\uff0c\u90fd\u65e0\u6cd5\u56de\u6536\u3002\n        //ThreadLocalOutOfMemoryTest.localVariable = null;\n        System.out.println("pool execute over");\n    }\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u7136\u540eheap dump\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u4e0b\u7ed3\u679c"}),"\n",(0,c.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,c.jsx)("img",{src:"/analysis-project/img/jvm/jvm-6.png",alt:"image",style:{maxWidth:"82%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"java.lang.ThreadLocal$ThreadLocalMap 9 (0%) 216 B (0%) 31,472,000 B (86.6%)"}),"\uff0c\u4e00\u4e2a",(0,c.jsx)(n.code,{children:"ThreadLocalMap"}),"\u672c\u8eab\u5360\u7528\u7684\u7a7a\u95f4size\u5f88\u5c0f\uff0c\u4f46\u662f\u5374\u5360\u636e\u6781\u9ad8\u7684",(0,c.jsx)(n.code,{children:"retained"}),"\uff0c\u8fd9\u5c31\u662f\u5185\u5b58\u6ea2\u51fa\u7684\u5f81\u5146\u3002",(0,c.jsxs)(n.em,{children:["\u8fd9\u91cc",(0,c.jsx)(n.code,{children:"retained"}),"\u8d85\u8fc7100%\uff0c\u662f\u56e0\u4e3a\u524d4\u4e2a\u7684\u7ebf\u7a0b\u76f8\u5173\u7684\u5bf9\u8c61\u662f\u5305\u542b\u5f15\u7528\u7684\uff0c\u800c\u4e14\u4e0a\u9762\u7684",(0,c.jsx)(n.code,{children:"byte[]"}),"\u6570\u7ec4\u672c\u8eab\u5c31\u662f\u5360\u7528\u5185\u5b58\u7684\u5bf9\u8c61\uff0c\u56e0\u4e3a\u5176\u76f8\u4e92\u4e00\u5c42\u5c42\u5305\u542b\uff0c\u6240\u4ee5\u5176",(0,c.jsx)(n.code,{children:"retained"}),"\u5360\u6bd4\u52a0\u8d77\u6765\u8d85\u8fc7\u4e86100%"]}),"\u3002"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4e5f\u53ef\u4ee5\u5207\u6362\u89c6\u56fe\uff0c\u67e5\u770b\u4ee5\u5b9e\u4f8b\u4e3a\u7edf\u8ba1\u7684\u5206\u5e03"})}),"\n",(0,c.jsxs)(n.p,{children:["\u4e0b\u56fe\u91cc\u7684",(0,c.jsx)(n.code,{children:"aggregation"}),"\u91cc\u7684package\uff1a\u6309\u5305\u6c47\u603b\u3001classes\uff1a\u6309\u7c7b\u6c47\u603b\u548cinstances\uff1a\u6309\u5b9e\u4f8b\u6c47\u603b"]}),"\n",(0,c.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,c.jsx)("img",{src:"/analysis-project/img/jvm/jvm-8.png",alt:"image",style:{maxWidth:"82%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,c.jsxs)(n.p,{children:["\u5728\u6309\u793a\u4f8b\u7684\u6c47\u603b\u91cc\uff0c\u5e76\u4e14\u5728\u4e0a\u4e00\u5c42\u4e2d\u7684",(0,c.jsx)(n.code,{children:"summary"}),"\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u4e00\u4e0b\u6570\u636e\u7edf\u8ba1\uff0c",(0,c.jsx)(n.code,{children:"Dominator by Retained Size"})," \u5c31\u662f\u54ea\u4e9b\u7c7b\u5f15\u7528\u5360\u7528\u4e86\u5927\u91cf\u7684\u7a7a\u95f4\u3002"]}),"\n",(0,c.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,c.jsx)("img",{src:"/analysis-project/img/jvm/jvm-7.png",alt:"image",style:{maxWidth:"82%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,c.jsx)(n.h3,{id:"\u5206\u6790metaspace\u6570\u636e",children:"\u5206\u6790metaspace\u6570\u636e"}),"\n",(0,c.jsx)(n.p,{children:"JVM\u7684MetaSpace\u5b58\u50a8\u7c7b\u7684\u5143\u4fe1\u606f\uff0c\u800c\u4e14\u662f\u5728\u5806\u5916\u5b58\u50a8\uff0c\u5728JDK8\u4e4b\u540e\uff0c\u6c38\u4e45\u4ee3\u88ab\u5f7b\u5e95\u5730\u79fb\u51fa\u4e86JVM\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u5143\u7a7a\u95f4MetaSpace\uff0c\u628a\u7c7b\u7684\u5143\u6570\u636e\u653e\u5230\u672c\u5730\u5316\u7684\u5806\u5185\u5b58native heap\u4e2d\uff0c\u8fd9\u5757\u533a\u57df\u5c31\u53ebMetaspace\uff0c\u6240\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u8f6c\u50a8\u6587\u4ef6\u662f\u4e0d\u80fd\u5206\u6790\u52a0\u8f7d\u7684\u7c7b\u7684\u4fe1\u606f\u7684\u3002"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"metaspace\u9700\u8981\u5173\u6ce8\u662f\u56e0\u4e3a\u5176\u4e5f\u4f1a\u5f15\u53d1metaspace oom\u800c\u5bfc\u81f4\u5e94\u7528\u5047\u6b7b\u6216\u9000\u51fa[metaspace oom](#metaspace oom)"}),"\u3002"]}),"\n",(0,c.jsx)(n.p,{children:"metaspace\u6570\u636e\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u7c7b\u5143\u6570\u636e\uff08Class Metadata\uff09"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u7c7b\u4fe1\u606f\uff1a\u5305\u62ec\u7c7b\u7684\u540d\u79f0\u3001\u8bbf\u95ee\u4fee\u9970\u7b26\u3001\u7236\u7c7b\u3001\u63a5\u53e3\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u7b49\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u65b9\u6cd5\u4fe1\u606f\uff1a\u65b9\u6cd5\u7684\u7b7e\u540d\u3001\u65b9\u6cd5\u4f53\uff08\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\uff09\uff0c\u5305\u62ec\u65b9\u6cd5\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7c7b\u578b\u7b49\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u5b57\u6bb5\u4fe1\u606f\uff1a\u7c7b\u5b57\u6bb5\u7684\u540d\u79f0\u3001\u7c7b\u578b\u3001\u4fee\u9970\u7b26\u7b49\u3002"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u65b9\u6cd5\u533a\u4fe1\u606f\uff08Method Area Metadata\uff09"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5e38\u91cf\u6c60\uff1a\u7c7b\u5e38\u91cf\u6c60\u5b58\u50a8\u4e86\u7c7b\u5b57\u8282\u7801\u4e2d\u7528\u5230\u7684\u6240\u6709\u5e38\u91cf\uff0c\u5305\u62ec\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u3001\u7c7b\u548c\u65b9\u6cd5\u5f15\u7528\u7b49\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff1a\u5728\u65b9\u6cd5\u533a\u4e2d\uff0c\u5b58\u50a8\u4e86\u6bcf\u4e2a\u7c7b\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff0c\u7528\u4e8e\u652f\u6301\u65b9\u6cd5\u8c03\u7528\u548c\u5e38\u91cf\u5f15\u7528\u3002"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u7c7b\u52a0\u8f7d\u5668\u4fe1\u606f\uff08ClassLoader Metadata\uff09"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u7c7b\u52a0\u8f7d\u5668\u5b9e\u4f8b\uff1a\u5305\u62ec\u6bcf\u4e2a\u7c7b\u52a0\u8f7d\u5668\u7684\u4fe1\u606f\uff0c\u8ddf\u8e2a\u6bcf\u4e2a\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u7c7b\u53ca\u5176\u76f8\u5173\u8d44\u6e90\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u7c7b\u52a0\u8f7d\u5668\u7684\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u4fe1\u606f**\uff1a\u63cf\u8ff0\u7c7b\u52a0\u8f7d\u5668\u7684\u5c42\u6b21\u7ed3\u6784\u548c\u59d4\u6d3e\u5173\u7cfb\u3002"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"JVM \u5185\u90e8\u6570\u636e\u7ed3\u6784"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Reflection \u6570\u636e\uff1a\u7528\u4e8e\u652f\u6301 Java \u53cd\u5c04 API \u7684\u6570\u636e\u7ed3\u6784\uff0c\u5305\u62ec\u53cd\u5c04\u83b7\u53d6\u7684\u7c7b\u3001\u65b9\u6cd5\u3001\u5b57\u6bb5\u4fe1\u606f\u7b49\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u7c7b\u6570\u636e\u7ed3\u6784\uff1a\u7c7b\u7684\u5185\u90e8\u8868\u793a\uff0c\u5305\u62ec\u7c7b\u7684\u5404\u79cd\u6570\u636e\u7ed3\u6784\u548c\u72b6\u6001\u4fe1\u606f\u3002"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u52a8\u6001\u751f\u6210\u7684\u7c7b"}),"\uff1a\u901a\u8fc7 JDK \u52a8\u6001\u4ee3\u7406\u6216 CGLIB \u751f\u6210\u7684\u52a8\u6001\u4ee3\u7406\u7c7b\u3002\u8fd9\u4e9b\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u548c\u5143\u6570\u636e\u4e5f\u5b58\u50a8\u5728 Metaspace \u4e2d\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5176\u4ed6\u5143\u6570\u636e"}),"\uff1a\u6bd4\u5982\u6ce8\u89e3\u4fe1\u606f\uff0c\u7528\u4e8e\u652f\u6301 Java \u6ce8\u89e3\u7684\u5143\u6570\u636e\uff0c\u5305\u62ec\u6ce8\u89e3\u7684\u5b9a\u4e49\u548c\u5176\u5e94\u7528\u4f4d\u7f6e\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"\u5206\u6790\u7c7b\u52a0\u8f7d\u7684\u6570\u636e",children:"\u5206\u6790\u7c7b\u52a0\u8f7d\u7684\u6570\u636e"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"jstat -class <pid>\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u770b\u5230\u52a0\u8f7d\u7c7b\u7684\u7a7a\u95f4\u5360\u7528\n\u6bd4\u5982\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"jstat -class 91776\nLoaded  Bytes  Unloaded  Bytes     Time\n   452  1135.2        0     0.0       0.00\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Loaded"}),": \u5df2\u52a0\u8f7d\u7684\u7c7b\u7684\u6570\u91cf\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Bytes"}),": \u5df2\u52a0\u8f7d\u7c7b\u7684\u5b57\u8282\u6570\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Unloaded"}),": \u5df2\u5378\u8f7d\u7684\u7c7b\u7684\u6570\u91cf\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Time"}),": \u7c7b\u52a0\u8f7d\u6216\u5378\u8f7d\u64cd\u4f5c\u6240\u7528\u7684\u65f6\u95f4\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Compiled"}),": \u5df2\u7f16\u8bd1\u7684\u65b9\u6cd5\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["arthas memory\narthas\u5de5\u5177\u4e2d\u7684",(0,c.jsx)(n.code,{children:"memory"}),"\u547d\u4ee4\u67e5\u770b JVM \u5185\u5b58\u4fe1\u606f\u3002\u5176\u4e2d\u53ef\u4ee5\u770b\u5230metaspace\u7684\u5360\u7528\u7edf\u8ba1"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"$ memory\nMemory                           used      total      max        usage\nheap                             32M       256M       4096M      0.79%\ng1_eden_space                    11M       68M        -1         16.18%\ng1_old_gen                       17M       184M       4096M      0.43%\ng1_survivor_space                4M        4M         -1         100.00%\nnonheap                          35M       39M        -1         89.55%\ncodeheap_'non-nmethods'          1M        2M         5M         20.53%\nmetaspace                        26M       27M        -1         96.88%\ncodeheap_'profiled_nmethods'     4M        4M         117M       3.57%\ncompressed_class_space           2M        3M         1024M      0.29%\ncodeheap_'non-profiled_nmethods' 685K      2496K      120032K    0.57%\nmapped                           0K        0K         -          0.00%\ndirect                           48M       48M        -          100.00%\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["arthas classloader\narthas ",(0,c.jsx)(n.code,{children:"classloader"})," \u547d\u4ee4\u53ef\u4ee5\u5c06 JVM \u4e2d\u6240\u6709\u7684 classloader \u7684\u4fe1\u606f\u7edf\u8ba1\u51fa\u6765\uff0c\u8fd9\u6837\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u7c7b\uff0c\u7279\u522b\u662f\u80fd\u770b\u9053\u6240\u6709\u7684\u52a0\u8f7d\u7c7b\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"$ classloader\n name                                       numberOfInstances  loadedCountTotal\n com.taobao.arthas.agent.ArthasClassloader  1                  2115\n BootstrapClassLoader                       1                  1861\n sun.reflect.DelegatingClassLoader          5                  5\n sun.misc.Launcher$AppClassLoader           1                  4\n sun.misc.Launcher$ExtClassLoader           1                  1\nAffect(row-cnt:5) cost in 3 ms.\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"-l "}),"\u53ef\u4ee5\u770b\u5230\u7edf\u8ba1\u6570\u636e\u4e2dclassloader\u7684\u7236\u52a0\u8f7d\u5668\uff0c",(0,c.jsx)(n.code,{children:"-t"})," \u53c2\u6570\u80fd\u770b\u5230classloader\u7684\u7236\u5b50\u5c42\u7ea7\u5173\u7cfb\n",(0,c.jsxs)(n.strong,{children:[(0,c.jsx)(n.code,{children:"classloader -a"}),"\uff0c\u80fd\u67e5\u770b\u6240\u6709\u52a0\u8f7d\u7684\u7c7b\uff0c\u4f46\u5185\u5bb9\u4f1a\u975e\u5e38\u7684\u591a\uff0c\u6ce8\u610f\u8f93\u51fa\u7684\u4f4d\u7f6e"]})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"[arthas@58950]$ classloader -a\n hash:null, BootstrapClassLoader\n Ljdk.internal.vm.FillerArray;\n [B\n [C\n [D\n [F\n [I\n [J\n [Lcom.sun.org.apache.xerces.internal.impl.XMLScanner$NameType;\n [Lcom.sun.org.apache.xerces.internal.util.Status;\n [Ljava.io.File$PathStatus;\n [Ljava.lang.Class;\n [Ljava.lang.ClassLoader;\n [Ljava.lang.ClassValue$Entry;\n [Ljava.lang.OutOfMemoryError;\n [Ljava.lang.ProcessImpl$LaunchMechanism;\n \u3002\u3002\u3002\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5728 ",(0,c.jsx)(n.code,{children:"classloader -a"})," \u8f93\u51fa\u4e2d\uff0c\u7c7b\u540d\u4e2d\u5305\u542b\u6807\u8bc6\uff08\u5982 ",(0,c.jsx)(n.code,{children:"Proxy"}),"\u3001",(0,c.jsx)(n.code,{children:"$Proxy"}),"\u3001",(0,c.jsx)(n.code,{children:"EnhancerByCGLIB"})," \u7b49\uff09\u7684\u7c7b\u5c31\u662f\u4ee3\u7406\u751f\u6210\u7684\u7c7b\u3002\u4ee5\u53ca\u5e26",(0,c.jsx)(n.code,{children:"$ "}),"\u7b26\u53f7\u7684\u7c7b\uff0c\u5176\u8868\u793a\u5185\u90e8\u7c7b\u3001\u533f\u540d\u7c7b\u6216\u67d0\u4e9b\u7279\u6b8a\u7684\u7f16\u8bd1\u65f6\u751f\u6210\u7684\u7c7b\u3002\u7279\u522b\u662f\u5f53metaspace oom\u5f80\u5f80\u5c31\u662f\u4ee3\u7406\u7c7b\u751f\u6210\u4e86\u7c7b\u5bfc\u81f4\u7684metaspace\u7a7a\u95f4\u98d9\u5347\u3002\n\u4f60\u53ef\u4ee5\u4f7f\u7528 classloader -l \u547d\u4ee4\u5217\u51fa\u6bcf\u4e2a\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u5177\u4f53\u7c7b\uff0c\u7ed3\u5408\u7c7b\u540d\u7684\u6a21\u5f0f\u6765\u5224\u65ad\u662f\u5426\u662f\u4ee3\u7406\u7c7b\u3002\n\u4e0a\u9762\u770b\u5230\u52a0\u8f7d\u7684\u7c7b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,c.jsx)(n.code,{children:"classloader -u"}),"\u53ef\u4ee5\u770b\u5230\u4e0d\u540c\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u4e86\u54ea\u4e9b\u5305\uff0c"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"[arthas@60213]$ classloader -u\n jdk.internal.loader.ClassLoaders$AppClassLoader@4e0e2f2a, hash:4e0e2f2a\n Used URLs:\n jrt:/jdk.jshell\n file:/Users/liufei/devtools/apache-maven-3.9.8/repo/cglib/cglib/3.3.0/cglib-3.3.0.jar\n Unused URLs:\n file:/Users/liufei/devtools/apache-maven-3.9.8/repo/com/alibaba/fastjson/2.0.52/fastjson-2.0.52.jar\n\n com.taobao.arthas.agent.ArthasClassloader@6f57b693, hash:6f57b693\n Used URLs:\n file:/Users/liufei/devtools/arthas-packaging-3.7.2-bin/arthas-core.jar\n Unused URLs:\n\n jdk.internal.loader.ClassLoaders$PlatformClassLoader@11aa3480, hash:11aa3480\n Used URLs:\n jrt:/jdk.crypto.cryptoki\n jrt:/java.xml.crypto\n Unused URLs:\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u7136\u540e\u4f7f\u7528",(0,c.jsx)(n.code,{children:"classloader -c <\u52a0\u8f7d\u5668hashcode>"}),"\u6765\u67e5\u770b\u5177\u4f53\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u5305\u548c\u7c7b\u6587\u4ef6\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"[arthas@60213]$ classloader -c 4e0e2f2a\nfile:/Users/liufei/code/Junit5-Test/target/classes/\nfile:/Users/liufei/devtools/apache-maven-3.9.8/repo/com/bpodgursky/jbool_expressions/1.23/jbool_expressions-1.23.jar\nfile:/Applications/IntelliJ%20IDEA.app/Contents/lib/idea_rt.jar\nfile:/Users/liufei/Library/Caches/JetBrains/IntelliJIdea2024.1/captureAgent/debugger-agent.jar\nfile:/Users/liufei/devtools/arthas-packaging-3.7.2-bin/arthas-agent.jar\n\u3002\u3002\u3002\nAffect(row-cnt:34) cost in 1 ms.\n"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"\u6ce8\u610f\u5927\u91cf\u7684\u5b57\u7b26\u4e32\u4f7f\u7528 intern() \u65b9\u6cd5\u4f1a\u5bfc\u81f4\u65b9\u6cd5\u533a\uff08Metaspace\uff09\u5185\u5b58\u5360\u7528\u589e\u52a0\uff0c\u548c\u5176\u4ed6\u4e00\u4e9b\u5e38\u91cf\u6c60\u4e2d\u7684\u6570\u636e\n\u8fd9\u6837\u901a\u8fc7metaspace\u7684\u6570\u636e\u7edf\u8ba1\u548c\u5177\u4f53\u52a0\u8f7d\u5668\u548c\u52a0\u8f7d\u7c7b\u4ee5\u53ca\u5206\u6790\u5e38\u91cf\u6570\u636e\uff0c\u7ed3\u5408\u4ee3\u7801\uff0c\u5927\u81f4\u5c31\u80fd\u5b9a\u4f4dmetaspace oom\u7684\u95ee\u9898\u662f\u54ea\u91cc\u5f15\u8d77\u7684\u3002"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"metaspace-oom",children:"Metaspace OOM"}),"\n",(0,c.jsx)(n.p,{children:"Metaspace OOM\u4f1a\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8f\u5047\u6b7b\u6216\u8005\u8fdb\u7a0b\u9000\u51fa"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"\u5e94\u7528\u7a0b\u5e8f\u5047\u6b7b\uff08Hang\uff09\uff1a\n\u5f53 Metaspace \u8017\u5c3d\u5185\u5b58\u5e76\u89e6\u53d1 OutOfMemoryError: Metaspace \u9519\u8bef\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u6240\u6709\u5c1d\u8bd5\u52a0\u8f7d\u65b0\u7c7b\u6216\u751f\u6210\u65b0\u7c7b\u7684\u64cd\u4f5c\u90fd\u4f1a\u5931\u8d25\u3002\u8fd9\u4e9b\u5931\u8d25\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u4e2d\u4e00\u4e9b\u7ebf\u7a0b\u5361\u4f4f\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u7ebf\u7a0b\u53ef\u80fd\u5728\u7b49\u5f85\u67d0\u4e9b\u8d44\u6e90\uff08\u4f8b\u5982\u7c7b\u52a0\u8f7d\u5668\u9501\uff09\u800c\u65e0\u6cd5\u7ee7\u7eed\u3002\u968f\u7740\u8d8a\u6765\u8d8a\u591a\u7684\u7ebf\u7a0b\u51fa\u73b0\u7c7b\u4f3c\u7684\u963b\u585e\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u9010\u6e10\u8fdb\u5165\u5047\u6b7b\u72b6\u6001\uff0c\u5373\u4f7f\u5b83\u5e76\u6ca1\u6709\u5b8c\u5168\u505c\u6b62\u3002"}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["\u8fdb\u7a0b\u9000\u51fa\uff08Crash\uff09\uff1a\n\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c",(0,c.jsx)(n.strong,{children:"\u5f53 JVM \u629b\u51fa OutOfMemoryError: Metaspace \u5f02\u5e38\u65f6\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u7ee7\u7eed\u8fd0\u884c"}),"\uff0c\u4f46\u5982\u679c\u6b64\u5f02\u5e38\u88ab\u4f20\u64ad\u5230\u4e00\u4e2a\u5173\u952e\u7684\u5730\u65b9\uff08\u4f8b\u5982\u7c7b\u52a0\u8f7d\u5668\u7684\u521d\u59cb\u5316\u4ee3\u7801\u6216\u5176\u4ed6\u5173\u952e\u7ec4\u4ef6\u4e2d\uff09\uff0c\u90a3\u4e48 JVM \u53ef\u80fd\u4f1a\u56e0\u4e3a\u65e0\u6cd5\u7ee7\u7eed\u6b63\u5e38\u64cd\u4f5c\u800c\u5d29\u6e83\uff08Crash\uff09\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cJava \u8fdb\u7a0b\u4f1a\u76f4\u63a5\u9000\u51fa\u3002"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u5178\u578b\u7684\u89e6\u53d1\u573a\u666f\u5305\u62ec\uff1a"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u52a8\u6001\u7c7b\u751f\u6210\u8fc7\u591a\uff08\u5982\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u3001\u5927\u91cf\u53cd\u5c04\u7b49\uff09\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u5927\u91cf\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93\uff0c\u5bfc\u81f4\u7c7b\u52a0\u8f7d\u8fc7\u591a\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u9891\u7e41\u52a0\u8f7d\u548c\u5378\u8f7d\u7c7b\uff0c\u800c\u5378\u8f7d\u7684\u7c7b\u6ca1\u6709\u53ca\u65f6\u88ab\u56de\u6536\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u5e94\u7528\u4e2d\u7684\u5185\u5b58\u6cc4\u6f0f\uff0c\u7279\u522b\u662f\u7c7b\u52a0\u8f7d\u5668\u7684\u5185\u5b58\u6cc4\u6f0f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5378\u8f7d\u7684\u7c7b\u65e0\u6cd5\u88ab\u5783\u573e\u56de\u6536\u5668\u6e05\u7406\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u5982\u4f55\u5904\u7406 Metaspace OOM"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u8c03\u6574 Metaspace \u5927\u5c0f\uff1a ",(0,c.jsx)(n.code,{children:"-XX:MetaspaceSize"}),"\u548c ",(0,c.jsx)(n.code,{children:"-XX:MaxMetaspaceSize"})," \u6765\u8c03\u6574 Metaspace \u7684\u521d\u59cb\u548c\u6700\u5927\u5927\u5c0f\u3002\u786e\u4fdd\u6700\u5927\u5927\u5c0f\u8db3\u591f\u5927\u4ee5\u5bb9\u7eb3\u5e94\u7528\u7684\u9700\u6c42\u3002"]}),"\n",(0,c.jsx)(n.li,{children:"\u51cf\u5c11\u7c7b\u52a0\u8f7d\uff1a\u5c3d\u91cf\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u7c7b\u52a0\u8f7d\uff0c\u4f18\u5316\u5e94\u7528\u4ee3\u7801\u548c\u4f9d\u8d56\u5e93\u7684\u4f7f\u7528\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u7c7b\u6216\u63a5\u53e3\u7684\u521b\u5efa\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u4f7f\u7528\u7c7b\u7f13\u5b58\uff1a\u5728\u52a8\u6001\u751f\u6210\u7c7b\u7684\u573a\u666f\u4e0b\uff08\u4f8b\u5982\u52a8\u6001\u4ee3\u7406\u7b49\uff09\uff0c\u53ef\u4ee5\u8003\u8651\u5bf9\u751f\u6210\u7684\u7c7b\u8fdb\u884c\u7f13\u5b58\uff0c\u907f\u514d\u91cd\u590d\u751f\u6210\u76f8\u540c\u7684\u7c7b\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u907f\u514d\u7c7b\u52a0\u8f7d\u5668\u6cc4\u6f0f\uff1a\u5c3d\u91cf\u907f\u514d\u7c7b\u52a0\u8f7d\u5668\u6cc4\u6f0f\uff0c\u7279\u522b\u662f\u5728 Web \u5e94\u7528\u670d\u52a1\u5668\u73af\u5883\u4e0b\uff08\u5982 Tomcat\u3001Jetty \u7b49\uff09\uff0c\u8981\u786e\u4fdd\u7c7b\u52a0\u8f7d\u5668\u548c\u7c7b\u4e4b\u95f4\u7684\u5f15\u7528\u80fd\u6b63\u786e\u6e05\u7406\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u5206\u6790gc\u65e5\u5fd7",children:"\u5206\u6790gc\u65e5\u5fd7"}),"\n",(0,c.jsxs)(n.p,{children:["\u5206\u6790jvm \u7684gc\u60c5\u51b5\uff0c\u4e0d\u662f\u5148\u770bgc\u65e5\u5fd7\uff0c\u800c\u662f\u770bgc\u7684\u6570\u91cf\u548c\u5206\u5e03\uff1a",(0,c.jsx)(n.code,{children:"young gc"}),"\u3001",(0,c.jsx)(n.code,{children:"old gc"}),"\u3001",(0,c.jsx)(n.code,{children:"full gc"}),"\u5206\u5e03\u662f\u600e\u4e48\u6837\u7684\uff0c\u5404\u53d1\u751f\u4e86\u591a\u5c11\u6b21\uff0c\u4e00\u822c\u90fd\u6709\u76d1\u63a7\u5de5\u5177\uff0c\u53ef\u4ee5\u76f4\u89c2\u770b\u5230\u3002gc\u65e5\u5fd7\u662f\u66f4\u8fd1\u4e00\u6b65\u7684\u6392\u67e5\u624b\u6bb5\u3002"]}),"\n",(0,c.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u6267\u884c\u7684\u4ee3\u7801"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-java",children:'package org.liufei.junit5.test.gc;\n\nimport java.util.Random;\nimport java.util.concurrent.TimeUnit;\nimport java.util.concurrent.atomic.LongAdder;\n\n/**\n * \u6f14\u793aGC\u65e5\u5fd7\u751f\u6210\u4e0e\u89e3\u8bfb\uff0c\u53c2\u8003\uff1ahttps://juejin.cn/post/7029130033268555807\n * jdk21 jvm\u53c2\u6570\uff1a\n * -Xmx512m -Xms512m  -Xlog:gc*,gc+heap=debug,gc+ref=debug:file=gc.log:tags,uptime,time,level:filecount=5,filesize=10M\n * gc+heap=debug\uff1a\u6307\u5b9a\u4e86\u4e0e gc \u548c heap \u76f8\u5173\u7684\u65e5\u5fd7\u6d88\u606f\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u7ea7\u522b\u8bbe\u7f6e\u4e3a debug\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u4ec5\u4f1a\u8bb0\u5f55\u57fa\u672c\u7684 GC \u4fe1\u606f\uff0c\u8fd8\u4f1a\u8bb0\u5f55\u4e0e\u5806\u5185\u5b58\u7ba1\u7406\uff08heap memory management\uff09\u76f8\u5173\u7684\u8be6\u7ec6\u8c03\u8bd5\u4fe1\u606f\n * gc+ref=debug\uff1a \u6307\u5b9a\u4e86\u4e0e gc \u548c ref\uff08\u5f15\u7528\u5904\u7406\uff09\u76f8\u5173\u7684\u65e5\u5fd7\u6d88\u606f\uff0c\u5e76\u5c06\u5176\u7ea7\u522b\u8bbe\u7f6e\u4e3a debug\u3002\u8fd9\u4f1a\u5305\u62ec\u8bf8\u5982\u5f31\u5f15\u7528\u3001\u8f6f\u5f15\u7528\u3001\u865a\u5f15\u7528\u548c\u7ec8\u7ed3\u5668\uff08finalizer\uff09\u5904\u7406\u7b49\u7ec6\u8282\u4fe1\u606f\u3002\n * file=gc.log\uff1a \u6307\u5b9a\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230\u6587\u4ef6 gc.log\u3002\n * tags,uptime,time,level\uff1a\n *  \ttags: \u65e5\u5fd7\u6761\u76ee\u7684\u6807\u7b7e\uff08\u5982 gc\u3001heap \u7b49\uff09\u3002\n *  \tuptime: JVM \u542f\u52a8\u4ee5\u6765\u7684\u65f6\u95f4\uff08\u76f8\u5bf9\u65f6\u95f4\uff09\u3002\n *  \ttime: \u7edd\u5bf9\u65f6\u95f4\u6233\uff0c\u8868\u793a\u65e5\u5fd7\u6761\u76ee\u4ea7\u751f\u7684\u5177\u4f53\u65f6\u95f4\u3002\n *  \tlevel: \u65e5\u5fd7\u7ea7\u522b\uff08\u5982 info\u3001debug\u3001warning \u7b49\uff09\u3002\n * filecount=5\uff1a \u6307\u5b9a\u6700\u591a\u4fdd\u7559 5 \u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002\u542f\u7528\u65e5\u5fd7\u8f6e\u8f6c\uff08rolling\uff09\u3002\u5f53\u65e5\u5fd7\u6587\u4ef6\u6570\u91cf\u8d85\u8fc7\u8fd9\u4e2a\u503c\u65f6\uff0c\u6700\u65e7\u7684\u6587\u4ef6\u5c06\u88ab\u5220\u9664\u3002\n * filesize=10M\uff1a\u6307\u5b9a\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u4e3a 10 MB\u3002\u5f53\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u8fbe\u5230 10 MB \u65f6\uff0c\u4f1a\u5f00\u59cb\u5199\u5165\u4e0b\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002\n *\n * @author liufei\n **/\npublic class GCLogAnalysis {\n    private static Random random = new Random();\n    public static void main(String[] args) {\n        // \u5f53\u524d\u6beb\u79d2\u65f6\u95f4\u6233\n        long startMillis = System.currentTimeMillis();\n        // \u6301\u7eed\u8fd0\u884c\u6beb\u79d2\u6570; \u53ef\u6839\u636e\u9700\u8981\u8fdb\u884c\u4fee\u6539\n        long timeoutMillis = TimeUnit.SECONDS.toMillis(1000);\n        // \u7ed3\u675f\u65f6\u95f4\u6233\n        long endMillis = startMillis + timeoutMillis;\n        LongAdder counter = new LongAdder();\n        System.out.println("\u6b63\u5728\u6267\u884c...");\n        // \u7f13\u5b58\u4e00\u90e8\u5206\u5bf9\u8c61; \u8fdb\u5165\u8001\u5e74\u4ee3\n        int cacheSize = 2000;\n        Object[] cachedGarbage = new Object[cacheSize];\n        // \u5728\u6b64\u65f6\u95f4\u8303\u56f4\u5185,\u6301\u7eed\u5faa\u73af\n        while (System.currentTimeMillis() < endMillis) {\n            // \u751f\u6210\u5783\u573e\u5bf9\u8c61\n            Object garbage = generateGarbage(100*1024);\n            counter.increment();\n            int randomIndex = random.nextInt(2 * cacheSize);\n            if (randomIndex < cacheSize) {\n                cachedGarbage[randomIndex] = garbage;\n            }\n        }\n        System.out.println("\u6267\u884c\u7ed3\u675f!\u5171\u751f\u6210\u5bf9\u8c61\u6b21\u6570:" + counter.longValue());\n    }\n\n    // \u751f\u6210\u5bf9\u8c61\n    private static Object generateGarbage(int max) {\n        int randomSize = random.nextInt(max);\n        int type = randomSize % 4;\n        Object result;\n        switch (type) {\n            case 0:\n                result = new int[randomSize];\n                break;\n            case 1:\n                result = new byte[randomSize];\n                break;\n            case 2:\n                result = new double[randomSize];\n                break;\n            default:\n                StringBuilder builder = new StringBuilder();\n                String randomString = "randomString-Anything";\n                while (builder.length() < randomSize) {\n                    builder.append(randomString);\n                    builder.append(max);\n                    builder.append(randomSize);\n                }\n                result = builder.toString();\n                break;\n        }\n        return result;\n    }\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u56e0\u4e3agc\u65e5\u5fd7\u4f9d\u8d56\u4e8e\u4f7f\u7528\u7684gc\u6536\u96c6\u5668\uff0c\u5176gc\u8fc7\u7a0b\u5b9e\u73b0\u4e0d\u540c\uff0c\u6240\u4ee5\u4e0d\u540c\u7684gc\u5668\u4f1a\u6709\u4e0d\u540c\u7684\u65e5\u5fd7\uff0c\u4e0b\u9762\u5c55\u793a\u4e24\u79cd\uff1a\u9002\u7528\u4e8e\u5c0f\u5185\u5b58jvm\u7684SerialGC\uff0c\u548c\u9002\u7528\u4e8e\u5927\u5185\u5b58jvm\u7684G1GC"}),"\n",(0,c.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684gc\u5468\u671f\uff0c\u65e5\u5fd7\u8f93\u51fa\uff1a"}),"\n",(0,c.jsx)(n.h4,{id:"-xxuseserialgc",children:"-XX:+UseSerialGC"}),"\n",(0,c.jsx)(n.p,{children:"SerialGC\u5c0f\u578bjvm\u7528\u7684\u591a\uff0c\u4f46gc\u505c\u987f\u65f6\u95f4\u957f"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"2024-08-30T18:15:17.773+0800][106.851s][info ][gc,start       ] GC(6578) Pause Full (Allocation Failure)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578) Heap before GC invocations=5983 (full 5974):\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)  def new generation   total 157248K, used 157246K [0x00000007e0000000, 0x00000007eaaa0000, 0x00000007eaaa0000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)   eden space 139776K, 100% used [0x00000007e0000000, 0x00000007e8880000, 0x00000007e8880000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)   from space 17472K,  99% used [0x00000007e9990000, 0x00000007eaa9f9c8, 0x00000007eaaa0000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)   to   space 17472K,   0% used [0x00000007e8880000, 0x00000007e8880000, 0x00000007e9990000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)  tenured generation   total 349568K, used 349567K [0x00000007eaaa0000, 0x0000000800000000, 0x0000000800000000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)    the space 349568K,  99% used [0x00000007eaaa0000, 0x00000007ffffffb0, 0x0000000800000000, 0x0000000800000000)\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)  Metaspace       used 503K, committed 704K, reserved 1114112K\n[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578)   class space    used 28K, committed 128K, reserved 1048576K\n[2024-08-30T18:15:17.774+0800][106.851s][info ][gc,phases,start] GC(6578) Phase 1: Mark live objects\n[2024-08-30T18:15:17.775+0800][106.852s][debug][gc,ref         ] GC(6578) Skipped SoftWeakFinalRefsPhase of Reference Processing: no references\n[2024-08-30T18:15:17.775+0800][106.852s][debug][gc,ref         ] GC(6578) Skipped KeepAliveFinalRefsPhase of Reference Processing: no references\n[2024-08-30T18:15:17.775+0800][106.852s][debug][gc,ref         ] GC(6578) Skipped PhantomRefsPhase of Reference Processing: no references\n[2024-08-30T18:15:17.775+0800][106.853s][info ][gc,phases      ] GC(6578) Phase 1: Mark live objects 1.084ms\n[2024-08-30T18:15:17.775+0800][106.853s][info ][gc,phases,start] GC(6578) Phase 2: Compute new object addresses\n[2024-08-30T18:15:17.775+0800][106.853s][info ][gc,phases      ] GC(6578) Phase 2: Compute new object addresses 0.592ms\n[2024-08-30T18:15:17.775+0800][106.853s][info ][gc,phases,start] GC(6578) Phase 3: Adjust pointers\n[2024-08-30T18:15:17.776+0800][106.854s][info ][gc,phases      ] GC(6578) Phase 3: Adjust pointers 0.688ms\n[2024-08-30T18:15:17.776+0800][106.854s][info ][gc,phases,start] GC(6578) Phase 4: Move objects\n[2024-08-30T18:15:17.785+0800][106.863s][info ][gc,phases      ] GC(6578) Phase 4: Move objects 9.317ms\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,heap        ] GC(6578) DefNew: 157246K(157248K)->13868K(157248K) Eden: 139776K(139776K)->13868K(139776K) From: 17470K(17472K)->0K(17472K)\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,heap        ] GC(6578) Tenured: 349567K(349568K)->349386K(349568K)\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,metaspace   ] GC(6578) Metaspace: 503K(704K)->503K(704K) NonClass: 474K(576K)->474K(576K) Class: 28K(128K)->28K(128K)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578) Heap after GC invocations=5984 (full 5975):\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)  def new generation   total 157248K, used 13868K [0x00000007e0000000, 0x00000007eaaa0000, 0x00000007eaaa0000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)   eden space 139776K,   9% used [0x00000007e0000000, 0x00000007e0d8b1e8, 0x00000007e8880000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)   from space 17472K,   0% used [0x00000007e9990000, 0x00000007e9990000, 0x00000007eaaa0000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)   to   space 17472K,   0% used [0x00000007e8880000, 0x00000007e8880000, 0x00000007e9990000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)  tenured generation   total 349568K, used 349386K [0x00000007eaaa0000, 0x0000000800000000, 0x0000000800000000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)    the space 349568K,  99% used [0x00000007eaaa0000, 0x00000007fffd2b38, 0x00000007fffd2c00, 0x0000000800000000)\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)  Metaspace       used 503K, committed 704K, reserved 1114112K\n[2024-08-30T18:15:17.786+0800][106.864s][debug][gc,heap        ] GC(6578)   class space    used 28K, committed 128K, reserved 1048576K\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc             ] GC(6578) Pause Full (Allocation Failure) 494M->354M(494M) 12.226ms\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,cpu         ] GC(6578) User=0.01s Sys=0.00s Real=0.01s\n[2024-08-30T18:15:17.792+0800][106.870s][info ][gc,start       ] GC(6579) Pause Full (Allocation Failure)\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u65e5\u5fd7\u89e3\u6790"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u542f\u52a8\u4fe1\u606f"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.773+0800][106.851s][info ][gc,start       ] GC(6578) Pause Full (Allocation Failure)\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u65f6\u95f4\u6233"}),": ",(0,c.jsx)(n.code,{children:"2024-08-30T18:15:17.773+0800"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u76f8\u5bf9\u65f6\u95f4"}),": ",(0,c.jsx)(n.code,{children:"106.851s"}),"\uff08JVM \u542f\u52a8\u540e\u7684\u65f6\u95f4\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u65e5\u5fd7\u7ea7\u522b"}),": ",(0,c.jsx)(n.code,{children:"info"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"GC ID"}),": ",(0,c.jsx)(n.code,{children:"GC(6578)"}),"--6578\u5c31\u662fgc\u7684\u5e8f\u53f7\uff0c\u5355\u8c03\u9012\u589e\uff0c\u76f8\u540c\u7684GC ID\u5c31\u662f\u540c\u4e00\u4e2aGC\u5468\u671f\u7684\u65e5\u5fd7"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"GC \u7c7b\u578b"}),": ",(0,c.jsx)(n.code,{children:"Pause Full"}),"\uff08\u5b8c\u6574\u7684\u6682\u505c\u5f0f\u5783\u573e\u56de\u6536\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u539f\u56e0"}),": ",(0,c.jsx)(n.code,{children:"Allocation Failure"}),"\uff08\u7531\u4e8e\u5185\u5b58\u5206\u914d\u5931\u8d25\u89e6\u53d1\u7684 GC\uff09"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u524d\u5806\u5185\u5b58\u72b6\u6001"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.774+0800][106.851s][debug][gc,heap        ] GC(6578) Heap before GC invocations=5983 (full 5974):\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5806\u5185\u5b58\u72b6\u6001"}),": ",(0,c.jsx)(n.code,{children:"5983"}),"\uff08\u5806\u5185\u5b58\u7684\u603b\u5927\u5c0f\uff09\u4ee5\u53ca ",(0,c.jsx)(n.code,{children:"full 5974"}),"\uff08\u5b8c\u5168\u7684\u5806\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u8be6\u7ec6\u4fe1\u606f"}),":"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5e74\u8f7b\u4ee3\uff08New Generation\uff09"}),":\n",(0,c.jsx)(n.em,{children:"\u5e74\u8f7b\u4ee3\u5206\u4e3a Eden \u533a\u57df\u548c\u4e24\u4e2a Survivor \u533a\u57df\uff08From \u548c To\uff09\uff0c\u8fd9\u6837\u662f\u56e0\u4e3agc\u4f7f\u7528\u590d\u5236\u6536\u96c6\uff08Copying Collection\uff09\u7b56\u7565\uff0c\u51cf\u5c11\u6807\u8bb0\u548c\u6e05\u9664\u7684\u590d\u6742\u6027\u3002\u65b9\u4fbf\u79fb\u52a8\u5bf9\u8c61\uff0c\u5e76\u4e14\u6bcf\u6b21\u5783\u573e\u56de\u6536\u53ea\u9700\u8981\u5173\u6ce8 Eden \u533a\u57df\u7684\u5bf9\u8c61\uff0c\u5e76\u5c06\u5e78\u5b58\u7684\u5bf9\u8c61\u4ece Eden \u533a\u57df\u590d\u5236\u5230 From \u533a\u57df\uff0c\u7b80\u5316\u4e86\u56de\u6536\u8fc7\u7a0b\u3002"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"GC(6578)  def new generation   total 157248K, used 157246K\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u603b\u5927\u5c0f ",(0,c.jsx)(n.code,{children:"157248K"}),"\uff0c\u5df2\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"157246K"}),"\uff08\u51e0\u4e4e\u6ee1\u4e86\uff09"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5e74\u8f7b\u4ee3\u7684 Eden \u533a\u57df"}),":\n",(0,c.jsx)(n.em,{children:"Eden \u662f\u5e74\u8f7b\u4ee3\u4e2d\u7684\u4e00\u4e2a\u533a\u57df\uff0c\u4e3b\u8981\u7528\u4e8e\u5206\u914d\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u3002"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"GC(6578)   eden space 139776K, 100% used\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u603b\u5927\u5c0f ",(0,c.jsx)(n.code,{children:"139776K"}),"\uff0c\u5df2\u4f7f\u7528",(0,c.jsx)(n.code,{children:"100%"})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5e74\u8f7b\u4ee3\u7684 From \u533a\u57df"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.em,{children:"From \u533a\u57df\uff08\u4e5f\u79f0\u4e3a Survivor \u533a\u57df\u4e4b\u4e00\uff09\u662f\u5e74\u8f7b\u4ee3\u4e2d\u7684\u4e00\u4e2a\u533a\u57df\uff0c\u7528\u4e8e\u5b58\u50a8\u4ece Eden \u533a\u57df\u664b\u5347\u7684\u5e78\u5b58\u5bf9\u8c61\uff0c\u5f53 Eden \u533a\u57df\u7684\u5783\u573e\u56de\u6536\u53d1\u751f\u65f6\uff0cEden \u4e2d\u7684\u5e78\u5b58\u5bf9\u8c61\u4f1a\u88ab\u590d\u5236\u5230 From \u533a\u57df\u3002From \u533a\u57df\u7684\u5b58\u5728\u4f7f\u5f97\u5e74\u8f7b\u4ee3\u80fd\u591f\u5904\u7406\u90a3\u4e9b\u5e78\u5b58\u4e86\u591a\u6b21\u5783\u573e\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u5e76\u5c06\u5b83\u4eec\u4fdd\u7559\u5728\u5e74\u8f7b\u4ee3\u4e2d\uff0c\u76f4\u5230\u5b83\u4eec\u664b\u5347\u5230\u8001\u5e74\u4ee3\u3002"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"GC(6578)   from space 17472K,  99% used\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u603b\u5927\u5c0f ",(0,c.jsx)(n.code,{children:"17472K"}),"\uff0c\u5df2\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"99%"})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5e74\u8f7b\u4ee3\u7684 To \u533a\u57df"}),":\n",(0,c.jsx)(n.em,{children:"To \u533a\u57df\uff08\u4e5f\u79f0\u4e3a Survivor \u533a\u57df\u4e4b\u4e8c\uff09\u662f\u5e74\u8f7b\u4ee3\u4e2d\u7684\u53e6\u4e00\u4e2a\u533a\u57df\uff0c\u4e0e From \u533a\u57df\u914d\u5bf9\u4f7f\u7528\u3002To \u533a\u57df\u7528\u4e8e\u5728\u5783\u573e\u56de\u6536\u8fc7\u7a0b\u4e2d\u63a5\u6536\u4ece From \u533a\u57df\u4e2d\u7684\u5bf9\u8c61\u3002\u6bcf\u6b21\u5783\u573e\u56de\u6536\u65f6\uff0cFrom \u548c To \u533a\u57df\u4f1a\u4e92\u6362\u89d2\u8272\u3002To \u533a\u57df\u7684\u5b58\u5728\u4f7f\u5f97\u5bf9\u8c61\u53ef\u4ee5\u5728 From \u548c To \u533a\u57df\u4e4b\u95f4\u6765\u56de\u79fb\u52a8\uff0c\u76f4\u5230\u5b83\u4eec\u88ab\u664b\u5347\u5230\u8001\u5e74\u4ee3\u3002"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"GC(6578)   to   space 17472K,   0% used\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u603b\u5927\u5c0f",(0,c.jsx)(n.code,{children:"17472K"}),"\uff0c\u5df2\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"0%"}),"\uff08\u7a7a\u95f2\uff09"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u8001\u5e74\u4ee3\uff08Tenured Generation\uff09"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"GC(6578)  tenured generation   total 349568K, used 349567K\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u603b\u5927\u5c0f",(0,c.jsx)(n.code,{children:"349568K"}),"\uff0c\u5df2\u4f7f\u7528",(0,c.jsx)(n.code,{children:"349567K"}),"\uff08\u51e0\u4e4e\u6ee1\u4e86\uff09"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5143\u7a7a\u95f4\uff08Metaspace\uff09"}),":"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-Tenured",children:"GC(6578)  Metaspace       used 503K, committed 704K, reserved 1114112K\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5df2\u4f7f\u7528"}),": ",(0,c.jsx)(n.code,{children:"503K"})," -- ",(0,c.jsx)(n.em,{children:"\u8fd9\u4e2a\u503c\u662f JVM \u5df2\u7ecf\u4f7f\u7528\u6765\u5b58\u50a8\u7c7b\u548c\u5176\u4ed6\u5143\u6570\u636e\u7684\u5b9e\u9645\u5185\u5b58\u91cf\u3002"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5df2\u63d0\u4ea4"}),": ",(0,c.jsx)(n.code,{children:"704K"})," --",(0,c.jsx)(n.em,{children:"\u8fd9\u4e2a\u503c\u8868\u793a JVM \u53ef\u4ee5\u968f\u65f6\u4f7f\u7528\u7684\u5185\u5b58\u91cf\u3002\u8fd9\u90e8\u5206\u5185\u5b58\u5df2\u7ecf\u4ece\u64cd\u4f5c\u7cfb\u7edf\u83b7\u5f97\uff0c\u4f46\u53ef\u80fd\u8fd8\u672a\u5168\u90e8\u4f7f\u7528\u3002committed \u7528\u4e86\u907f\u514d\u9891\u7e41\u7684\u53bb\u7533\u8bf7\u5185\u5b58\uff0c\u5982\u679c\u8fd8\u6709\u6551\u76f4\u63a5\u4f7f\u7528\u7684\u5185\u5b58\uff0c\u901a\u5e38\u5927\u4e8e\u6216\u7b49\u4e8e used\u3002"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5df2\u4fdd\u7559"}),": ",(0,c.jsx)(n.code,{children:"1114112K"})," -- ",(0,c.jsx)(n.em,{children:"\u8868\u793a JVM \u4e3a Metaspace \u4fdd\u7559\u7684\u6700\u5927\u5185\u5b58\u91cf\u662f 1114112 KB\uff08\u5373\u7ea6 1 GB\uff09\u3002\u8fd9\u4e2a\u503c\u8868\u793a JVM \u4e3a\u672a\u6765\u4f7f\u7528\u800c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u5185\u5b58\u8303\u56f4\uff0c\u5b9e\u9645\u4e0a\u53ef\u80fd\u5e76\u672a\u5168\u90e8\u5206\u914d\u6216\u4f7f\u7528\u3002reserved \u503c\u9650\u5236\u4e86 Metaspace \u53ef\u4ee5\u6269\u5c55\u5230\u7684\u6700\u5927\u5927\u5c0f\u3002"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u5404\u9636\u6bb5\u65f6\u95f4"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.774+0800][106.851s][info ][gc,phases,start] GC(6578) Phase 1: Mark live objects\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u9636\u6bb5"}),":"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Phase 1: Mark live objects"}),"\uff08\u6807\u8bb0\u5b58\u6d3b\u5bf9\u8c61\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Phase 2: Compute new object addresses"}),"\uff08\u8ba1\u7b97\u65b0\u5bf9\u8c61\u5730\u5740\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Phase 3: Adjust pointers"}),"\uff08\u8c03\u6574\u6307\u9488\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Phase 4: Move objects"}),"\uff08\u79fb\u52a8\u5bf9\u8c61\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u9636\u6bb5\u5b8c\u6210\u65f6\u95f4"}),":","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"Phase 1: 1.084ms"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"Phase 2: 0.592ms"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"Phase 3: 0.688ms"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"Phase 4: 9.317ms"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u540e\u5806\u5185\u5b58\u72b6\u6001"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,heap        ] GC(6578) DefNew: 157246K(157248K)->13868K(157248K) Eden: 139776K(139776K)->13868K(139776K) From: 17470K(17472K)->0K(17472K)\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,heap        ] GC(6578) Tenured: 349567K(349568K)->349386K(349568K)\n[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,metaspace   ] GC(6578) Metaspace: 503K(704K)->503K(704K) NonClass: 474K(576K)->474K(576K) Class: 28K(128K)->28K(128K)\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5e74\u8f7b\u4ee3\uff08New Generation\uff09"}),":\n\u4e4b\u524d: ",(0,c.jsx)(n.code,{children:"157246K"}),"\uff08\u603b\u5927\u5c0f\uff09 -> ",(0,c.jsx)(n.code,{children:"13868K"}),"\uff08\u5df2\u4f7f\u7528\uff09\uff0cEden \u533a\u57df ",(0,c.jsx)(n.code,{children:"139776K"})," -> ",(0,c.jsx)(n.code,{children:"13868K"}),"\uff0cFrom \u533a\u57df ",(0,c.jsx)(n.code,{children:"17470K"})," -> ",(0,c.jsx)(n.code,{children:"0K"}),"\uff0cTo \u533a\u57df",(0,c.jsx)(n.code,{children:"0K"}),"\uff08\u672a\u4f7f\u7528\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u8001\u5e74\u4ee3\uff08Tenured Generation\uff09"}),":\n\u4e4b\u524d",(0,c.jsx)(n.code,{children:"349567K"}),"\uff08\u5df2\u4f7f\u7528\uff09 -> ",(0,c.jsx)(n.code,{children:"349386K"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5143\u7a7a\u95f4\uff08Metaspace\uff09"}),":\n\u4e4b\u524d ",(0,c.jsx)(n.code,{children:"503K"}),"\uff08\u5df2\u4f7f\u7528\uff09 -> ",(0,c.jsx)(n.code,{children:"503K"}),"\uff0cNonClass",(0,c.jsx)(n.code,{children:"474K"})," -> ",(0,c.jsx)(n.code,{children:"474K"}),"\uff0cClass",(0,c.jsx)(n.code,{children:"28K"})," -> ",(0,c.jsx)(n.code,{children:"28K"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC \u5b8c\u6210\u4fe1\u606f"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.786+0800][106.864s][info ][gc             ] GC(6578) Pause Full (Allocation Failure) 494M->354M(494M) 12.226ms\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"GC \u7c7b\u578b"}),": ",(0,c.jsx)(n.code,{children:"Pause Full (Allocation Failure)"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5806\u5185\u5b58\u53d8\u5316"}),": ",(0,c.jsx)(n.code,{children:"494M"})," -> ",(0,c.jsx)(n.code,{children:"354M"}),"\uff08GC \u4e4b\u524d\u548c\u4e4b\u540e\u7684\u5806\u5185\u5b58\u4f7f\u7528\u91cf\uff09"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"GC \u8017\u65f6"}),": ",(0,c.jsx)(n.code,{children:"12.226ms"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"GC CPU \u65f6\u95f4"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T18:15:17.786+0800][106.864s][info ][gc,cpu         ] GC(6578) User=0.01s Sys=0.00s Real=0.01s\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u7528\u6237\u65f6\u95f4: ",(0,c.jsx)(n.code,{children:"0.01s"}),"\uff0c\u7cfb\u7edf\u65f6\u95f4: ",(0,c.jsx)(n.code,{children:"0.00s"}),"\uff0c\u5b9e\u9645\u65f6\u95f4: ",(0,c.jsx)(n.code,{children:"0.01s"})]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"-xxuseg1gc",children:"-XX:+UseG1GC"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,start       ] GC(22681) Pause Young (Normal) (G1 Evacuation Pause)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681) Heap before GC invocations=20873 (full 1980):\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  garbage-first heap   total 524288K, used 489425K [0x00000007e0000000, 0x0000000800000000)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   region size 1024K, 1 young (1024K), 0 survivors (0K)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  Metaspace       used 491K, committed 704K, reserved 1114112K\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   class space    used 25K, committed 128K, reserved 1048576K\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,task        ] GC(22681) Using 8 workers of 8 for evacuation\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,ref         ] GC(22681) Skipped SoftWeakFinalRefsPhase of Reference Processing: no references\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,ref         ] GC(22681) Skipped KeepAliveFinalRefsPhase of Reference Processing: no references\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,ref         ] GC(22681) Skipped PhantomRefsPhase of Reference Processing: no references\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Pre Evacuate Collection Set: 0.1ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Merge Heap Roots: 0.0ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Evacuate Collection Set: 0.1ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Post Evacuate Collection Set: 0.2ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Other: 0.0ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Eden regions: 1->0(0)\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Survivor regions: 0->0(0)\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Old regions: 352->353\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Humongous regions: 159->159\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,metaspace   ] GC(22681) Metaspace: 491K(704K)->491K(704K) NonClass: 466K(576K)->466K(576K) Class: 25K(128K)->25K(128K)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681) Heap after GC invocations=20874 (full 1980):\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  garbage-first heap   total 524288K, used 490173K [0x00000007e0000000, 0x0000000800000000)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   region size 1024K, 0 young (0K), 0 survivors (0K)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  Metaspace       used 491K, committed 704K, reserved 1114112K\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   class space    used 25K, committed 128K, reserved 1048576K\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc             ] GC(22681) Pause Young (Normal) (G1 Evacuation Pause) (Evacuation Failure) 478M->478M(512M) 0.537ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,cpu         ] GC(22681) User=0.00s Sys=0.00s Real=0.00s\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,ergo        ] Attempting full compaction\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,start       ] GC(22682) Pause Full (G1 Compaction Pause)\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u4e2a GC \u5468\u671f\u4e2d G1 \u5783\u573e\u6536\u96c6\u5668\u8fdb\u884c\u7684\u5e74\u8f7b\u4ee3 GC\uff08\u56de\u6536 Eden \u533a\u57df\uff09\uff0c\u5e76\u4e14\u7531\u4e8e\u56de\u6536\u64cd\u4f5c\u5931\u8d25\uff0c\u5e74\u8f7b\u4ee3\u7684\u4f7f\u7528\u91cf\u6ca1\u6709\u51cf\u5c11\u3002\u4e4b\u540e\uff0c\u7cfb\u7edf\u5c1d\u8bd5\u8fdb\u884c\u5168\u5806\u538b\u7f29\u64cd\u4f5c\u4ee5\u4f18\u5316\u5185\u5b58\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u7ec6\u8282\u89e3\u91ca\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u4e8b\u4ef6\u542f\u52a8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,start       ] GC(22681) Pause Young (Normal) (G1 Evacuation Pause)\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"GC(22681)"}),": \u8fd9\u662f\u5f53\u524d\u7684 GC \u4e8b\u4ef6\u7684 ID\u3002\n",(0,c.jsx)(n.strong,{children:"Pause Young (Normal) (G1 Evacuation Pause)"}),": \u8fd9\u662f GC \u7684\u7c7b\u578b\u548c\u539f\u56e0\u3002\u5728 G1 GC \u4e2d\uff0c\u201cPause Young\u201d \u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u5e74\u8f7b\u4ee3\u5783\u573e\u6536\u96c6\uff0c\u800c\u201cG1 Evacuation Pause\u201d\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u7528\u4e8e\u56de\u6536\u5e74\u8f7b\u4ee3\u7684\u6682\u505c\u4e8b\u4ef6\uff0c\u8fdb\u884c\u7684\u662f G1 GC \u7684\u56de\u6536\u64cd\u4f5c\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u524d\u7684\u5806\u5185\u5b58\u72b6\u6001"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681) Heap before GC invocations=20873 (full 1980):\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  garbage-first heap   total 524288K, used 489425K [0x00000007e0000000, 0x0000000800000000]\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   region size 1024K, 1 young (1024K), 0 survivors (0K)\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)  Metaspace       used 491K, committed 704K, reserved 1114112K\n[2024-08-30T19:17:13.979+0800][34.531s][debug][gc,heap        ] GC(22681)   class space    used 25K, committed 128K, reserved 1048576K\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Heap before GC"}),": GC \u4e4b\u524d\u7684\u5806\u5185\u5b58\u72b6\u6001\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"garbage-first heap"}),": \u4f7f\u7528\u7684\u5783\u573e\u4f18\u5148 (G1) \u5806\u7684\u603b\u5927\u5c0f\u4e3a 524,288K (512MB)\uff0c\u5df2\u4f7f\u7528 489,425K\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"region size 1024K"}),": \u5806\u7684\u533a\u57df\u5927\u5c0f\u662f 1MB\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"1 young (1024K), 0 survivors (0K)"}),": \u5e74\u8f7b\u4ee3\u4e2d\u6709 1 \u4e2a\u533a\u57df\uff08\u603b\u8ba1 1MB\uff09\uff0c\u6ca1\u6709\u5e78\u5b58\u8005\u533a\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Metaspace"}),": \u5143\u7a7a\u95f4\u7684\u72b6\u6001\u3002\u5df2\u4f7f\u7528 491K\uff0c\u5df2\u63d0\u4ea4 704K\uff0c\u4fdd\u7559 1,114,112K\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u4efb\u52a1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,task        ] GC(22681) Using 8 workers of 8 for evacuation\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Using 8 workers of 8 for evacuation"}),": \u5728\u6b64\u6b21 GC \u4e8b\u4ef6\u4e2d\uff0cG1 GC \u4f7f\u7528\u4e86 8 \u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u8fdb\u884c\u5783\u573e\u56de\u6536\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u9636\u6bb5"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Pre Evacuate Collection Set: 0.1ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Merge Heap Roots: 0.0ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Evacuate Collection Set: 0.1ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Post Evacuate Collection Set: 0.2ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,phases      ] GC(22681)   Other: 0.0ms\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Pre Evacuate Collection Set"}),": GC \u524d\u7684\u96c6\u5408\u51c6\u5907\u9636\u6bb5\uff0c\u8017\u65f6 0.1ms\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Merge Heap Roots"}),": \u5408\u5e76\u5806\u6839\u9636\u6bb5\uff0c\u8017\u65f6 0.0ms\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Evacuate Collection Set"}),": \u5b9e\u9645\u7684\u533a\u57df\u56de\u6536\u9636\u6bb5\uff0c\u8017\u65f6 0.1ms\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Post Evacuate Collection Set"}),": \u56de\u6536\u540e\u7684\u6e05\u7406\u9636\u6bb5\uff0c\u8017\u65f6 0.2ms\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Other"}),": \u5176\u4ed6\u65f6\u95f4\uff0c\u8017\u65f6 0.0ms\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u540e\u7684\u5806\u5185\u5b58\u72b6\u6001"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Eden regions: 1->0(0)\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Survivor regions: 0->0(0)\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Old regions: 352->353\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,heap        ] GC(22681) Humongous regions: 159->159\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Eden regions"}),": \u5e74\u8f7b\u4ee3\u4e2d\u7684 Eden \u533a\u57df\u4ece 1 \u4e2a\u51cf\u5c11\u5230 0 \u4e2a\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Survivor regions"}),": \u5e74\u8f7b\u4ee3\u4e2d\u7684\u5e78\u5b58\u8005\u533a\u57df\u4ece 0 \u4e2a\u51cf\u5c11\u5230 0 \u4e2a\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Old regions"}),": \u5e74\u8001\u4ee3\u4e2d\u7684\u533a\u57df\u4ece 352 \u4e2a\u589e\u52a0\u5230 353 \u4e2a\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Humongous regions"}),": \u5927\u5bf9\u8c61\u533a\u57df (Humongous regions) \u4ece 159 \u4e2a\u4fdd\u6301\u4e0d\u53d8\u3002"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u540e\u7684 Metaspace \u72b6\u6001"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,metaspace   ] GC(22681) Metaspace: 491K(704K)->491K(704K) NonClass: 466K(576K)->466K(576K) Class: 25K(128K)->25K(128K)\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Metaspace"}),": GC \u540e\u5143\u7a7a\u95f4\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u5143\u7a7a\u95f4\u603b\u5171\u4f7f\u7528 491K\uff0c\u63d0\u4ea4 704K\uff0c\u4fdd\u7559 1,114,112K\u3002\u7c7b\u7a7a\u95f4\u7684\u4f7f\u7528\u60c5\u51b5\u4e5f\u5217\u51fa\uff0c\u5176\u4e2d\u7c7b\u7a7a\u95f4\u7684\u4f7f\u7528\u91cf\u4ece 25K \u4e0d\u53d8\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"GC \u603b\u4f53\u4fe1\u606f"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-scss",children:"[2024-08-30T19:17:13.979+0800][34.531s][info ][gc             ] GC(22681) Pause Young (Normal) (G1 Evacuation Pause) (Evacuation Failure) 478M->478M(512M) 0.537ms\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,cpu         ] GC(22681) User=0.00s Sys=0.00s Real=0.00s\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,ergo        ] Attempting full compaction\n[2024-08-30T19:17:13.979+0800][34.531s][info ][gc,start       ] GC(22682) Pause Full (G1 Compaction Pause)\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Pause Young (Normal)"}),": \u5e74\u8f7b\u4ee3 GC \u7c7b\u578b\uff0cG1 Evacuation Pause\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"(Evacuation Failure)"}),": \u8868\u793a\u56de\u6536\u64cd\u4f5c\u5931\u8d25\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"478M->478M(512M)"}),": GC \u524d\u540e\u5806\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5206\u522b\u662f 478MB\uff0c\u5806\u7684\u603b\u5927\u5c0f\u4e3a 512MB\u3002\u7531\u4e8e\u6b64\u6b21 GC \u7684\u56de\u6536\u5931\u8d25\uff0c\u5806\u7684\u4f7f\u7528\u91cf\u6ca1\u6709\u51cf\u5c11\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"0.537ms"}),": GC \u64cd\u4f5c\u7684\u6301\u7eed\u65f6\u95f4\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"GC(22681) User=0.00s Sys=0.00s Real=0.00s"}),": GC \u64cd\u4f5c\u7684 CPU \u4f7f\u7528\u65f6\u95f4\u548c\u5b9e\u9645\u65f6\u95f4\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Attempting full compaction"}),": \u5c1d\u8bd5\u8fdb\u884c\u5b8c\u5168\u538b\u7f29\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Pause Full (G1 Compaction Pause)"}),": \u5168\u505c\u987f\u7c7b\u578b\u7684 GC\uff0cG1 \u5b8c\u5168\u538b\u7f29\u6682\u505c\u3002"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var c=s(6540);const r={},l=c.createContext(r);function i(e){const n=c.useContext(l);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),c.createElement(l.Provider,{value:n},e.children)}}}]);