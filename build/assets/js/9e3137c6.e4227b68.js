"use strict";(self.webpackChunkanalytic_project=self.webpackChunkanalytic_project||[]).push([[8404],{4743:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>a});var r=i(4848),o=i(8453);const s={title:"ForkJoinPool",sidebar_position:7,toc_min_heading_level:2,toc_max_heading_level:5},t=void 0,l={id:"JavaDocs/JUC/JUC-ForkJoinPool",title:"ForkJoinPool",description:"ForkJoinPool\u7406\u89e3",source:"@site/docs/JavaDocs/JUC/JUC-ForkJoinPool.mdx",sourceDirName:"JavaDocs/JUC",slug:"/JavaDocs/JUC/JUC-ForkJoinPool",permalink:"/analysis-project/docs/JavaDocs/JUC/JUC-ForkJoinPool",draft:!1,unlisted:!1,editUrl:"https://github.com/Swagger-Ranger/analysis-project/docs/JavaDocs/JUC/JUC-ForkJoinPool.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"ForkJoinPool",sidebar_position:7,toc_min_heading_level:2,toc_max_heading_level:5},sidebar:"jdkSidebar",previous:{title:"ThreadPoolExecutor",permalink:"/analysis-project/docs/JavaDocs/JUC/JUC-ThreadPoolExecutor"},next:{title:"CompletableFuture",permalink:"/analysis-project/docs/JavaDocs/JUC/JUC-CompletableFuture"}},d={},a=[{value:"ForkJoinPool\u7406\u89e3",id:"forkjoinpool\u7406\u89e3",level:3},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:3},{value:"ForkJoinTask",id:"forkjointask",level:3},{value:"ForkJoinPool\u6570\u636e\u7ed3\u6784",id:"forkjoinpool\u6570\u636e\u7ed3\u6784",level:3}];function c(n){const e={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h3,{id:"forkjoinpool\u7406\u89e3",children:"ForkJoinPool\u7406\u89e3"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u662fJDK7\u63d0\u4f9b\u7684\u4e00\u79cd\u201c\u5206\u6cbb\u7b97\u6cd5\u201d\u7684\u591a\u7ebf\u7a0b\u5e76\u884c\u8ba1\u7b97\u6846\u67b6\uff0c\u4e3b\u8981\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u9ad8\u6548\u5730\u5904\u7406\u5927\u89c4\u6a21\u7684\u5e76\u884c\u8ba1\u7b97\u4efb\u52a1\u3002\u53ef\u4ee5\u5c06",(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u770b\u4f5c\u4e00\u4e2a\u5355\u673a\u7248\u7684",(0,r.jsx)(e.code,{children:"Map/Reduce"}),"\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u7684\u5e76\u884c\u4e0d\u662f\u591a\u53f0\u673a\u5668\u5e76\u884c\u8ba1\u7b97\uff0c\u800c\u662f\u591a\u4e2a\u7ebf\u7a0b\u5e76\u884c\u8ba1\u7b97\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u76f8\u6bd4\u4e8e ",(0,r.jsx)(e.code,{children:"ThreadPoolExecutor"})," \uff0c ",(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u53ef\u4ee5\u66f4\u597d\u5730\u5b9e\u73b0\u8ba1\u7b97\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u63d0\u9ad8\u8d44\u6e90\u5229\u7528\u7387\u3002\u5047\u8bbe\u67095\u4e2a\u4efb\u52a1\uff0c\u5728",(0,r.jsx)(e.code,{children:"ThreadPoolExecutor"}),"\u4e2d\u67095\u4e2a\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\uff0c\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u7684\u8ba1\u7b97\u91cf\u5f88\u5927\uff0c\u5176\u4f594\u4e2a\u4efb\u52a1\u7684\u8ba1\u7b97\u91cf\u5f88\u5c0f\uff0c\u8fd9\u4f1a\u5bfc\u81f41\u4e2a\u7ebf\u7a0b\u5f88\u5fd9\uff0c\u5176\u4ed64\u4e2a\u7ebf\u7a0b\u5219\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u3002\u800c\u5229\u7528",(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\uff0c\u53ef\u4ee5\u628a\u5927\u7684\u4efb\u52a1\u62c6\u5206\u6210\u5f88\u591a\u5c0f\u4efb\u52a1\uff0c\u7136\u540e \u8fd9\u4e9b\u5c0f\u4efb\u52a1\u88ab\u6240\u6709\u7684\u7ebf\u7a0b\u6267\u884c\uff0c\u4ece\u800c\u5b9e\u73b0\u4efb\u52a1\u8ba1\u7b97\u7684\u8d1f\u8f7d\u5747\u8861\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u5148\u6765\u770b\u4e24\u4e2a\u4f8b\u5b50\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package org.liufei.junit5.test;\n\nimport java.util.concurrent.RecursiveAction;\n\n/**\n * @author liufei\n **/\npublic class PrintTask extends RecursiveAction {\n    private final int start, end;\n    private static final int THRESHOLD = 10; // \u5206\u6cbb\u7684\u9608\u503c\n\n    public PrintTask(int start, int end) {\n        this.start = start;\n        this.end = end;\n    }\n\n    @Override\n    protected void compute() {\n        if (end - start <= THRESHOLD) {\n            for (int i = start; i < end; i++) {\n                System.out.println(Thread.currentThread().getName() + "  Processing index: " + i);\n            }\n        } else {\n            int mid = (start + end) / 2;\n            PrintTask leftTask = new PrintTask(start, mid);\n            PrintTask rightTask = new PrintTask(mid, end);\n            invokeAll(leftTask, rightTask); // \u5e76\u884c\u6267\u884c\u5b50\u4efb\u52a1\n        }\n    }\n\n    public static void main(String[] args) {\n        PrintTask printTask = new PrintTask(1, 60);\n        printTask.compute();\n    }\n}\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package org.liufei.junit5.test;\n\nimport java.util.concurrent.RecursiveTask;\n\n/**\n * @author liufei\n **/\npublic class SumTask extends RecursiveTask<Integer> {\n    private final int[] array;\n    private final int   start, end;\n    private static final int THRESHOLD = 10; // \u5206\u6cbb\u7684\u9608\u503c\n\n    public SumTask(int[] array, int start, int end) {\n        this.array = array;\n        this.start = start;\n        this.end = end;\n    }\n\n    @Override\n    protected Integer compute() {\n        if (end - start <= THRESHOLD) {\n            int sum = 0;\n            for (int i = start; i < end; i++) {\n                sum += array[i];\n            }\n            return sum;\n        } else {\n            int mid = (start + end) / 2;\n            SumTask leftTask = new SumTask(array, start, mid);\n            SumTask rightTask = new SumTask(array, mid, end);\n            leftTask.fork(); // \u5f02\u6b65\u6267\u884c\u5de6\u4efb\u52a1\n            int rightResult = rightTask.compute(); // \u540c\u6b65\u6267\u884c\u53f3\u4efb\u52a1\u5e76\u83b7\u53d6\u7ed3\u679c\n            int leftResult = leftTask.join(); // \u7b49\u5f85\u5de6\u4efb\u52a1\u7ed3\u679c\n            return leftResult + rightResult;\n        }\n    }\n\n    public static void main(String[] args) {\n        int[] array = new int[]{1, 5, 6, 2, 8, 99, 12, 43, 56, 76,\n                                2, 8, 99, 12, 43, 56, 76, 2, 8, 99,\n                                12, 43, 56, 76, 5, 6, 2, 8, 99, 12,\n                                43, 56, 5, 6, 2, 8, 99, 12, 43, 56,\n                                5, 6, 2, 8, 99, 12, 43, 56};\n        SumTask sumTask = new SumTask(array, 0, array.length);\n        Integer compute = sumTask.compute();\n        System.out.println(compute);\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"forkjointask",children:"ForkJoinTask"}),"\n",(0,r.jsx)(e.p,{children:"\u53ef\u4ee5\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u770b\u5230\uff1a"}),"\n",(0,r.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,r.jsx)("img",{src:"/analysis-project/img/juc/juc-22.png",alt:"image",style:{maxWidth:"60%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:[(0,r.jsx)(e.code,{children:"ForkJoinTask"})," \u662f ",(0,r.jsx)(e.code,{children:"ForkJoinPool"})," \u5206\u6cbb\u6846\u67b6\u7684\u6838\u5fc3\u62bd\u8c61\u3002",(0,r.jsx)(e.code,{children:"ForkJoinTask"})," \u63d0\u4f9b\u4e86\u4e00\u4e9b\u57fa\u672c\u7684\u673a\u5236\uff0c\u7528\u4e8e\u652f\u6301\u5206\u89e3\u4efb\u52a1\u3001\u4efb\u52a1\u7684\u5e76\u884c\u6267\u884c\u4ee5\u53ca\u7ed3\u679c\u7684\u5408\u5e76\u3002",(0,r.jsx)(e.code,{children:"ForkJoinPool"})," \u7684\u4f7f\u7528\u4f9d\u8d56\u4e8e ",(0,r.jsx)(e.code,{children:"ForkJoinTask"})," \u6765\u63d0\u4ea4\u4efb\u52a1\u3002",(0,r.jsx)(e.code,{children:"ForkJoinTask"})," \u662f ",(0,r.jsx)(e.code,{children:"ForkJoinPool"})," \u4e2d\u4efb\u52a1\u7684\u57fa\u672c\u62bd\u8c61\uff0c\u6240\u6709\u9700\u8981\u5e76\u884c\u6267\u884c\u7684\u4efb\u52a1\u90fd\u5fc5\u987b\u88ab\u5c01\u88c5\u6210 ",(0,r.jsx)(e.code,{children:"ForkJoinTask"})," \u7684\u5b50\u7c7b\uff0c\u624d\u80fd\u88ab ",(0,r.jsx)(e.code,{children:"ForkJoinPool"})," \u5904\u7406\u3002"]})}),"\n",(0,r.jsxs)(e.p,{children:["\u9664\u4e86",(0,r.jsx)(e.code,{children:"RecursiveTask"}),"\u3001",(0,r.jsx)(e.code,{children:"RecursiveAction"}),"\u8fd8\u6709",(0,r.jsx)(e.code,{children:"CountedCompleter"}),"\u4e5f\u662f\u4e00\u4e2a\u6838\u5fc3\u5b9e\u73b0\u7c7b\uff0c\u5176\u4e2d\uff1a"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"RecursiveTask<V>"}),"\uff1a\u7528\u4e8e\u6709\u8fd4\u56de\u503c\u7684\u4efb\u52a1\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"RecursiveAction"}),"\uff1a\u7528\u4e8e\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u4efb\u52a1\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"CountedCompleter<T>"}),"\uff1a\u4e00\u79cd\u66f4\u590d\u6742\u7684\u4efb\u52a1\u7c7b\u578b\uff0c\u9002\u7528\u4e8e\u975e\u9012\u5f52\u3001\u5f02\u6b65\u6267\u884c\u7684\u4efb\u52a1\uff0c\u5e76\u4e14\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b8c\u6210\u6761\u4ef6\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"ForkJoinTask \u6838\u5fc3\u65b9\u6cd5\uff1a"})}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u65b9\u6cd5"}),(0,r.jsx)(e.th,{children:"\u63cf\u8ff0"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"fork()"})}),(0,r.jsx)(e.td,{children:"\u5f02\u6b65\u5730\u6267\u884c\u4efb\u52a1\uff0c\u5b89\u6392\u4efb\u52a1\u5728\u5176\u4ed6\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"join()"})}),(0,r.jsx)(e.td,{children:"\u7b49\u5f85\u4efb\u52a1\u5b8c\u6210\u5e76\u8fd4\u56de\u5176\u7ed3\u679c\uff08\u5982\u679c\u6709\uff09\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"invoke()"})}),(0,r.jsxs)(e.td,{children:["\u6267\u884c\u4efb\u52a1\u5e76\u7b49\u5f85\u5176\u5b8c\u6210\uff08\u7ed3\u5408 ",(0,r.jsx)(e.code,{children:"fork"})," \u548c ",(0,r.jsx)(e.code,{children:"join"}),"\uff09\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:(0,r.jsx)(e.code,{children:"exec()"})})}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"\u6267\u884c\u4efb\u52a1\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u7531\u5b50\u7c7b\u5b9e\u73b0\uff0c\u7528\u4e8e\u5b9e\u9645\u4efb\u52a1\u6267\u884c\u903b\u8f91\u3002"})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"invokeAll(...)"})}),(0,r.jsx)(e.td,{children:"\u5e76\u884c\u5730\u6267\u884c\u4e00\u7ec4\u4efb\u52a1\uff0c\u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"isCompletedNormally()"})}),(0,r.jsx)(e.td,{children:"\u68c0\u67e5\u4efb\u52a1\u662f\u5426\u6b63\u5e38\u5b8c\u6210\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"cancel(boolean mayInterruptIfRunning)"})}),(0,r.jsx)(e.td,{children:"\u53d6\u6d88\u4efb\u52a1\u6267\u884c\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"isDone()"})}),(0,r.jsx)(e.td,{children:"\u68c0\u67e5\u4efb\u52a1\u662f\u5426\u5df2\u5b8c\u6210\u3002"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"forkjoinpool\u6570\u636e\u7ed3\u6784",children:"ForkJoinPool\u6570\u636e\u7ed3\u6784"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u6700\u6838\u5fc3\u7684\u6a21\u5f0f\u5982\u4e0b\u56fe\uff1a"]}),"\n",(0,r.jsx)("div",{style:{textAlign:"center",width:"100%"},children:(0,r.jsx)("img",{src:"/analysis-project/img/juc/juc-23.png",alt:"image",style:{maxWidth:"50%",height:"auto",display:"block",margin:"0 auto"}})}),"\n",(0,r.jsx)(e.p,{children:"\u4e0a\u9762\u5bf9\u5e94\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5168\u5c40\u961f\u5217\u5bf9\u5e94\u7684\u5c31\u662f ",(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u7684",(0,r.jsx)(e.code,{children:"WorkQueue[] queues"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5c40\u90e8\u961f\u5217\u5bf9\u5e94\u7684\u5c31\u662f ",(0,r.jsx)(e.code,{children:"WorkQueue"}),"\u7684",(0,r.jsx)(e.code,{children:"ForkJoinTask<?>[] array"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6267\u884c\u7ebf\u7a0b\u5bf9\u5e94\u7684\u5c31\u662f ",(0,r.jsx)(e.code,{children:"WorkQueue"}),"\u7684",(0,r.jsx)(e.code,{children:"ForkJoinWorkerThread owner"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5177\u4f53\u7684\u6bcf\u4e2a\u4efb\u52a1\u5bf9\u5e94\u7684\u5c31\u662f ",(0,r.jsx)(e.code,{children:"ForkJoinTask"}),"\u5c01\u88c5\u4efb\u52a1\u5bf9\u8c61"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5177\u4f53\u7684\u7ed3\u6784\u548c\u53c2\u6570\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"// ForkJoinPool\u7684\u6570\u636e\u7ed3\u6784\n// Instance fields\n    volatile long stealCount;            // collects worker nsteals\n    volatile long threadIds;             // for worker thread names\n    final long keepAlive;                // milliseconds before dropping if idle\n    final long bounds;                   // min, max threads packed as shorts\n    final int config;                    // static configuration bits\n    volatile int runState;               // SHUTDOWN, STOP, TERMINATED bits\n    WorkQueue[] queues;                  // main registry\n    final ReentrantLock registrationLock;\n    Condition termination;               // lazily constructed\n    final String workerNamePrefix;       // null for common pool\n    final ForkJoinWorkerThreadFactory factory;\n    final UncaughtExceptionHandler ueh;  // per-worker UEH\n    final Predicate<? super ForkJoinPool> saturate;\n    final SharedThreadContainer container;\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// WorkQueue\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u91cc\u7684\u961f\u5217\u5e76\u4e0d\u662fBlockingQueue\u800c\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u901a\u8fc7base\u7ef4\u62a4\u961f\u5c3e\u548ctop\u7ef4\u62a4\u961f\u5934\uff0c\u4ece\u4e0b\u9762\u4ee3\u7801\u4e2d\u5c31\u53ef\u4ee5\u770b\u5230\nstatic final class WorkQueue {\n        int stackPred;             // pool stack (ctl) predecessor link\n        int config;                // index, mode, ORed with SRC after init\n        int base;                  // index of next slot for poll\n        ForkJoinTask<?>[] array;   // the queued tasks; power of 2 size\n        final ForkJoinWorkerThread owner; // owning thread or null if shared\n        // fields otherwise causing more unnecessary false-sharing cache misses\n        @jdk.internal.vm.annotation.Contended("w")\n        int top;                   // index of next slot for push\n        @jdk.internal.vm.annotation.Contended("w")\n        volatile int access;       // values 0, 1 (locked), PARKED, STOP\n        @jdk.internal.vm.annotation.Contended("w")\n        volatile int phase;        // versioned, negative if inactive\n        @jdk.internal.vm.annotation.Contended("w")\n        volatile int source;       // source queue id in topLevelExec\n        @jdk.internal.vm.annotation.Contended("w")\n        int nsteals;               // number of steals from other queues\n  ...\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"// ForkJoinWorkerThread \u5b9e\u9645\u7684\u6267\u884c\u7ebf\u7a0b\npublic class ForkJoinWorkerThread extends Thread {\n    /*\n     * ForkJoinWorkerThreads are managed by ForkJoinPools and perform\n     * ForkJoinTasks. For explanation, see the internal documentation\n     * of class ForkJoinPool.\n     *\n     * This class just maintains links to its pool and WorkQueue.\n     */\n    final ForkJoinPool pool;                // the pool this thread works in\n    final ForkJoinPool.WorkQueue workQueue; // work-stealing mechanics\n\n    /**\n     * Full nonpublic constructor.\n     */\n    ForkJoinWorkerThread(ThreadGroup group, ForkJoinPool pool,\n                         boolean useSystemClassLoader,\n                         boolean clearThreadLocals) {\n        super(group, null, pool.nextWorkerThreadName(), 0L, !clearThreadLocals);\n        UncaughtExceptionHandler handler = (this.pool = pool).ueh;\n        this.workQueue = new ForkJoinPool.WorkQueue(this, 0);\n        if (clearThreadLocals)\n            workQueue.setClearThreadLocals();\n        // ForkJoinPool\u4e2d\u521b\u5efa\u7684\u7ebf\u7a0b\u90fd\u662f\u5b88\u62a4\u7ebf\u7a0b\n        super.setDaemon(true);\n        if (handler != null)\n            super.setUncaughtExceptionHandler(handler);\n        if (useSystemClassLoader)\n            super.setContextClassLoader(ClassLoader.getSystemClassLoader());\n    }\n\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u5bf9\u4e8e\u4e0a\u9762",(0,r.jsx)(e.code,{children:"ForkJoinPool"}),"\u7684\u53c2\u6570\uff0c\u5728\u6784\u9020\u51fd\u6570\u4e2d\u6709\u5982\u4e0b\u5904\u7406\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// \u8fd9\u4e2a\u5c31\u662fForkJoinPool\u5bf9\u5e94\u53c2\u6570\npublic ForkJoinPool(int parallelism,\n                        ForkJoinWorkerThreadFactory factory,\n                        UncaughtExceptionHandler handler,\n                        boolean asyncMode,\n                        int corePoolSize,\n                        int maximumPoolSize,\n                        int minimumRunnable,\n                        Predicate<? super ForkJoinPool> saturate,\n                        long keepAliveTime,\n                        TimeUnit unit) {\n        checkPermission();\n        int p = parallelism;\n        if (p <= 0 || p > MAX_CAP || p > maximumPoolSize || keepAliveTime <= 0L)\n            throw new IllegalArgumentException();\n        if (factory == null || unit == null)\n            throw new NullPointerException();\n        this.parallelism = p;\n        this.factory = factory;\n        this.ueh = handler;\n        this.saturate = saturate;\n        this.config = asyncMode ? FIFO : 0;\n        this.keepAlive = Math.max(unit.toMillis(keepAliveTime), TIMEOUT_SLOP);\n        int corep = Math.clamp(corePoolSize, p, MAX_CAP);\n        int maxSpares = Math.clamp(maximumPoolSize - p, 0, MAX_CAP);\n        int minAvail = Math.clamp(minimumRunnable, 0, MAX_CAP);\n        this.bounds = (long)(minAvail & SMASK) | (long)(maxSpares << SWIDTH) |\n            ((long)corep << 32);\n        int size = 1 << (33 - Integer.numberOfLeadingZeros(p - 1));\n        this.registrationLock = new ReentrantLock();\n        this.queues = new WorkQueue[size];\n        String pid = Integer.toString(getAndAddPoolIds(1) + 1);\n        String name = "ForkJoinPool-" + pid;\n        this.workerNamePrefix = name + "-worker-";\n        this.container = SharedThreadContainer.create(name);\n    }\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"ForkJoinPool"})," \u6784\u9020\u51fd\u6570\u53c2\u6570\u7684\u8be6\u7ec6\u89e3\u91ca\uff1a"]}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u53c2\u6570\u540d"}),(0,r.jsx)(e.th,{children:"\u542b\u4e49"}),(0,r.jsx)(e.th,{children:"\u4f5c\u7528"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"int parallelism"})}),(0,r.jsx)(e.td,{children:"\u5e76\u884c\u5ea6\uff0c\u5373\u7ebf\u7a0b\u6c60\u4e2d\u53ef\u540c\u65f6\u5e76\u884c\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\u3002"}),(0,r.jsx)(e.td,{children:"\u51b3\u5b9a\u7ebf\u7a0b\u6c60\u7684\u57fa\u672c\u5de5\u4f5c\u7ebf\u7a0b\u6570\uff0c\u901a\u5e38\u8bbe\u7f6e\u4e3a CPU \u6838\u5fc3\u6570\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"ForkJoinWorkerThreadFactory factory"})}),(0,r.jsx)(e.td,{children:"\u7ebf\u7a0b\u5de5\u5382\u63a5\u53e3\uff0c\u7528\u4e8e\u521b\u5efa\u5de5\u4f5c\u7ebf\u7a0b\u3002"}),(0,r.jsx)(e.td,{children:"\u5141\u8bb8\u81ea\u5b9a\u4e49\u5de5\u4f5c\u7ebf\u7a0b\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u5982\u6307\u5b9a\u7ebf\u7a0b\u540d\u79f0\u3001\u4f18\u5148\u7ea7\u7b49\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"UncaughtExceptionHandler handler"})}),(0,r.jsx)(e.td,{children:"\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u5668\uff0c\u7528\u4e8e\u5904\u7406\u5de5\u4f5c\u7ebf\u7a0b\u4e2d\u672a\u6355\u83b7\u7684\u5f02\u5e38\u3002"}),(0,r.jsx)(e.td,{children:"\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u903b\u8f91\uff0c\u5982\u8bb0\u5f55\u65e5\u5fd7\u6216\u6062\u590d\u64cd\u4f5c\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"boolean asyncMode"})}),(0,r.jsx)(e.td,{children:"\u5f02\u6b65\u6a21\u5f0f\u6807\u5fd7\u3002"}),(0,r.jsxs)(e.td,{children:[(0,r.jsx)(e.code,{children:"true"})," \u8868\u793a FIFO \u987a\u5e8f\u5904\u7406\u4efb\u52a1\uff0c",(0,r.jsx)(e.code,{children:"false"})," \u8868\u793a LIFO \u987a\u5e8f\u5904\u7406\u4efb\u52a1\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"int corePoolSize"})}),(0,r.jsx)(e.td,{children:"\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u5373\u4f7f\u5728\u7a7a\u95f2\u65f6\u4e5f\u4fdd\u6301\u6d3b\u52a8\u7684\u7ebf\u7a0b\u6570\u3002"}),(0,r.jsx)(e.td,{children:"\u4fdd\u6301\u4e00\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\u5e38\u9a7b\uff0c\u4ee5\u4fbf\u968f\u65f6\u5904\u7406\u65b0\u4efb\u52a1\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"int maximumPoolSize"})}),(0,r.jsx)(e.td,{children:"\u5141\u8bb8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002"}),(0,r.jsx)(e.td,{children:"\u5728\u8d1f\u8f7d\u9ad8\u5cf0\u65f6\u5141\u8bb8\u521b\u5efa\u66f4\u591a\u7ebf\u7a0b\u6765\u5904\u7406\u4efb\u52a1\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"int minimumRunnable"})}),(0,r.jsx)(e.td,{children:"\u6700\u5c0f\u53ef\u8fd0\u884c\u7ebf\u7a0b\u6570\u91cf\u3002"}),(0,r.jsx)(e.td,{children:"\u5f3a\u5236\u542f\u52a8\u66f4\u591a\u7ebf\u7a0b\u4ee5\u8fbe\u5230\u8fd9\u4e2a\u6700\u5c0f\u503c\uff0c\u907f\u514d\u8d44\u6e90\u95f2\u7f6e\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"Predicate<? super ForkJoinPool> saturate"})}),(0,r.jsx)(e.td,{children:"\u8c13\u8bcd\uff0c\u7528\u4e8e\u51b3\u5b9a\u4f55\u65f6\u963b\u6b62\u65b0\u4efb\u52a1\u7684\u63d0\u4ea4\u4ee5\u907f\u514d\u7ebf\u7a0b\u6c60\u9971\u548c\u3002"}),(0,r.jsx)(e.td,{children:"\u81ea\u5b9a\u4e49\u4f55\u65f6\u505c\u6b62\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u907f\u514d\u7ebf\u7a0b\u6c60\u8fc7\u8f7d\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"long keepAliveTime"})}),(0,r.jsx)(e.td,{children:"\u975e\u6838\u5fc3\u7ebf\u7a0b\u5728\u7ec8\u6b62\u524d\u4fdd\u6301\u7a7a\u95f2\u7684\u65f6\u95f4\u3002"}),(0,r.jsx)(e.td,{children:"\u63a7\u5236\u7a7a\u95f2\u975e\u6838\u5fc3\u7ebf\u7a0b\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u8d85\u65f6\u540e\u4f1a\u88ab\u7ec8\u6b62\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:"TimeUnit unit"})}),(0,r.jsxs)(e.td,{children:["\u65f6\u95f4\u5355\u4f4d\uff0c\u7528\u4e8e\u6307\u5b9a ",(0,r.jsx)(e.code,{children:"keepAliveTime"}),"\u53c2\u6570\u7684\u5355\u4f4d\u3002"]}),(0,r.jsxs)(e.td,{children:["\u51b3\u5b9a ",(0,r.jsx)(e.code,{children:"keepAliveTime"}),"\u662f\u4ee5\u79d2\u3001\u6beb\u79d2\u3001\u5206\u949f\u7b49\u4e3a\u5355\u4f4d\u3002"]})]})]})]}),"\n",(0,r.jsx)(e.p,{children:"...todo \u6e90\u7801\u5b9e\u5728\u592a\u957f\uff0c\u540e\u9762\u518d\u8865\u5145"})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>l});var r=i(6540);const o={},s=r.createContext(o);function t(n){const e=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);