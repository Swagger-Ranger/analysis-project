---
title: AT事务比XA事务快的原因
sidebar_position: 10
toc_min_heading_level: 2
toc_max_heading_level: 5
---
### 性能差异的原因

xa事务性能慢的原因很大程度在于其等待每个节点的执行确认，如果一个业务中多个事务则xa事务的性能就等于每个最慢节点的耗时之和；而at事务则可以在多事务链中可以继续往后执行，通过全局锁来协调，这样一个业务中多个事务的耗时就等于平均节点的耗时之和。

<div style={{ textAlign: 'center', width: '100%' }}>
    <img src="/analysis-project/img/sa/xa-at.png" alt="image" style={{ maxWidth: '60%', height: 'auto', display: 'block', margin: '0 auto' }} />
</div>

[//]: # (<img src="/Users/liufei/docs/typora笔记/images/sa/xa-at.png" style="zoom:50%;" />)

#### XA（ eXtended Architecture）事务

XA 事务是两阶段提交（2PC, Two-Phase Commit）协议的一种实现。它通过协调多个参与者（通常是数据库）来确保事务的一致性。

- **第一阶段（Prepare 阶段）**：协调者向所有参与者发送准备请求，参与者执行事务并将结果写入准备日志，但不提交。参与者向协调者返回准备成功或失败的响应。
- **第二阶段（Commit 阶段）**：如果所有参与者都返回准备成功，协调者向所有参与者发送提交请求；否则，发送回滚请求。参与者执行提交或回滚操作。

由于 XA 事务的两阶段提交过程，每个节点的性能都会受到最慢节点的影响，即事务的整体执行时间等于最慢节点的执行时间。此外，事务的提交需要等待所有参与者的响应，因此在网络延迟和节点性能不均衡的情况下，XA 事务的性能可能会受到显著影响。

#### AT （Application Transaction）事务

AT 事务（Auto-Commit Transaction）通常在微服务架构中使用，并通过分布式协调器来管理全局事务。AT 事务的主要特点是每个子事务可以独立提交或回滚，从而减少整体事务的等待时间。

- **全局锁的协调**：AT 事务使用全局锁或其他协调机制来确保事务的一致性。全局锁的存在可以防止并发写入导致的数据不一致问题。
- **事务链的继续执行**：在 AT 事务中，每个子事务可以在不等待其他子事务的情况下继续执行，这减少了事务链的整体等待时间。

由于 AT 事务允许子事务独立提交或回滚，因此多个子事务的执行时间可以并行化，从而将整体事务的耗时缩短到所有子事务平均耗时之和，而不是最慢子事务的耗时。

