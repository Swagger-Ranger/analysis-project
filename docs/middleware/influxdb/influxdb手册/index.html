<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-middleware/influxdb/influxdb手册" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">influxdb手册 | Analysis Project</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://Swagger-Ranger.github.io/analysis-project/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://Swagger-Ranger.github.io/analysis-project/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://Swagger-Ranger.github.io/analysis-project/docs/middleware/influxdb/influxdb手册"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="influxdb手册 | Analysis Project"><meta data-rh="true" name="description" content="本文基于InfluxDB OSS v2官方文档，系个人的阅读笔记和个人理解。"><meta data-rh="true" property="og:description" content="本文基于InfluxDB OSS v2官方文档，系个人的阅读笔记和个人理解。"><link data-rh="true" rel="icon" href="/analysis-project/img/apachecassandra-color.svg"><link data-rh="true" rel="canonical" href="https://Swagger-Ranger.github.io/analysis-project/docs/middleware/influxdb/influxdb手册"><link data-rh="true" rel="alternate" href="https://Swagger-Ranger.github.io/analysis-project/docs/middleware/influxdb/influxdb手册" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://Swagger-Ranger.github.io/analysis-project/docs/middleware/influxdb/influxdb手册" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/analysis-project/blog/rss.xml" title="Analysis Project RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/analysis-project/blog/atom.xml" title="Analysis Project Atom Feed"><link rel="stylesheet" href="/analysis-project/assets/css/styles.460af289.css">
<script src="/analysis-project/assets/js/runtime~main.9bd9d26e.js" defer="defer"></script>
<script src="/analysis-project/assets/js/main.31d2dea2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/analysis-project/"><div class="navbar__logo"><img src="/analysis-project/img/apachecassandra-color.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/analysis-project/img/apachecassandra-color.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/analysis-project/docs/projectDesign/whatIs">All for analysis</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/analysis-project/docs/middleware/disruptor">Middlewares</a><a class="navbar__item navbar__link" href="/analysis-project/docs/category/juc">Codes</a><a class="navbar__item navbar__link" href="/analysis-project/docs/DevOps/JavaOptimizing">DevOps</a><a class="navbar__item navbar__link" href="/analysis-project/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/analysis-project/about">关于作者</a><a href="https://github.com/Swagger-Ranger/analysis-project" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/disruptor">concurrentFramework</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/analysis-project/docs/middleware/influxdb/influxdb手册">influxdb</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/analysis-project/docs/middleware/influxdb/influxdb手册">influxdb手册</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/kakfa/Kafka手册1-功能">kakfa</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/logicTool/逻辑工具">logicTool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/lucene/Lucene手册1-索引">lucene</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/neo4j/neo4j手册">neo4j</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/presto/presto手册">presto</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/analysis-project/docs/middleware/starrocks/starRocks手册">starrocks</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/analysis-project/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">influxdb</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">influxdb手册</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>influxdb手册</h1></header><p>本文基于<a href="https://docs.influxdata.com/influxdb/v2/" target="_blank" rel="noopener noreferrer">InfluxDB OSS v2</a>官方文档，系个人的阅读笔记和个人理解。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="版本信息">版本信息<a href="#版本信息" class="hash-link" aria-label="版本信息的直接链接" title="版本信息的直接链接">​</a></h2>
<p>InfluxDB OSS (Open Source Software) 是 InfluxDB 的开源版本。它是单节点部署，适用于开发者、个人项目和小规模应用。如果是集群部署则需要使用InfluxDB Enterprise：闭源收费，或者InfluxDB Cluster：自己管理的InfluxDB Enterprise k8s云原生版本，InfluxDB Cloud：InfluxData 提供的云托管版本。除了InfluxDB OSS 其他的版本都是不开源且收费的。</p>
<p>如果InfluxDB OSS 想要部署集群：</p>
<ol>
<li>备份已有的InfluxDB OSS 数据 <code>influxd backup -portable /path/to/backup</code> ，然后安装InfluxDB的集群收费版本将数据迁移过去。这个主要是要注意数据平滑迁移的问题：</li>
</ol>
<p><strong>双写机制</strong>：在迁移过程中，可以将数据同时写入旧的InfluxDB OSS实例和新的InfluxDB 集群中，确保数据的一致性和完整性。</p>
<p><strong>逐步切换读请求</strong>：迁移完成后，逐步将读请求从旧实例切换到新的集群，确保系统的稳定性。</p>
<p><strong>验证数据一致性</strong>：迁移完成后，验证新集群中的数据是否完整和一致，确保没有数据丢失或错误。</p>
<ol start="2">
<li>
<p>使用第三方解决方案</p>
</li>
<li>
<p><strong>使用开源工具如Kapacitor和Telegraf</strong>：</p>
</li>
</ol>
<ul>
<li>
<p>使用Telegraf收集数据，并将数据写入多个InfluxDB OSS实例中。</p>
</li>
<li>
<p>使用Kapacitor来处理数据的实时流和告警功能。</p>
</li>
</ul>
<ol start="2">
<li><strong>自建负载均衡和数据分片机制</strong>：</li>
</ol>
<ul>
<li>可以在应用层自定义数据分片和负载均衡策略，将数据写入不同的InfluxDB OSS实例。</li>
<li>需要额外开发和维护代码来管理数据的读写和协调。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装部署">安装部署<a href="#安装部署" class="hash-link" aria-label="安装部署的直接链接" title="安装部署的直接链接">​</a></h2>
<p>环境信息：centos7.9</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h3>
<p><a href="https://download.influxdata.com/influxdb/releases/influxdb2-2.7.6-1.x86_64.rpm" target="_blank" rel="noopener noreferrer">下载</a></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> influxdb2-2.7.6-1.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 启动influxdb服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> influxdb start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 查看服务状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> influxdb status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="调整启动参数">调整启动参数<a href="#调整启动参数" class="hash-link" aria-label="调整启动参数的直接链接" title="调整启动参数的直接链接">​</a></h3>
<ol>
<li>编辑<code>/etc/default/influxdb2</code>服务配置文件以将配置指令分配给influxd命令行标志 - 例如，添加一行或多<code>&lt;ENV_VARIABLE_NAME&gt;=&lt;COMMAND_LINE_FLAG&gt;</code>行如下内容：</li>
</ol>
<blockquote>
<p>ARG1=&quot;--http-bind-address :8087&quot;
ARG2=&quot;--storage-wal-fsync-delay=15m&quot;</p>
</blockquote>
<ol start="2">
<li>编辑<code>/lib/systemd/system/influxdb.service</code>文件以将变量传递给ExecStart值：</li>
</ol>
<blockquote>
<p>ExecStart=/usr/bin/influxd <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>R</mi><mi>G</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">ARG1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">RG</span><span class="mord">1</span></span></span></span>ARG2</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="influx-ui">influx ui<a href="#influx-ui" class="hash-link" aria-label="influx ui的直接链接" title="influx ui的直接链接">​</a></h3>
<p>安装好之后，通过 <code>http://&lt;influxdb_host&gt;:8086</code> 就能够访问influx 提供的ui界面。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#输入密码用户之后，生成API token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#liufei  Lf123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Wftn6R5gqz23mMBBHNi1MD48uNYmX4KvYRxBJcifW3uPR8wI6Z-NgyDDEWRbLysnrFA809cVHu496sF-N6pvwA==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Wftn6R5gqz23mMBBHNi1MD48uNYmX4KvYRxBJcifW3uPR8wI6Z-NgyDDEWRbLysnrFA809cVHu496sF-N6pvwA==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="influx-cli">Influx cli<a href="#influx-cli" class="hash-link" aria-label="Influx cli的直接链接" title="Influx cli的直接链接">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.influxdata.com/influxdb/releases/influxdb2-client-2.3.0-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xvzf path/to/influxdb2-client-latest-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 配置环境变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code-snippet code keyword" style="color:#00009f">`echo $PATH`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token blockquote punctuation" style="color:#393A34">&gt;</span><span class="token plain"> [root@influxdb influxdb2-client-2.3.0-linux-amd64]# echo $PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token blockquote punctuation" style="color:#393A34">&gt;</span><span class="token plain"> /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 将解压的influx命令行工具，拷贝到对应目录下</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp path/to/influx /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 测试命令行工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code-snippet code keyword" style="color:#00009f">`influx version`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token blockquote punctuation" style="color:#393A34">&gt;</span><span class="token plain"> [root@influxdb influxdb2-client-2.3.0-linux-amd64]# influx version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token blockquote punctuation" style="color:#393A34">&gt;</span><span class="token plain"> Influx CLI 2.3.0 (git: 88ba346) build_date: 2022-04-06T19:30:53Z</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cli命令">cli命令<a href="#cli命令" class="hash-link" aria-label="cli命令的直接链接" title="cli命令的直接链接">​</a></h4>
<p><code>influx</code> 直接就能输出influx有的命令内容</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@influxdb influxdb2-client-2.3.0-linux-amd64</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># influx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   influx - Influx Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USAGE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   influx </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMANDS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   version              Print the influx CLI version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">write</span><span class="token plain">                Write points to InfluxDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GLOBAL OPTIONS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --help, </span><span class="token parameter variable" style="color:#36acaa">-h</span><span class="token plain">  show </span><span class="token builtin class-name">help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过<code>influx [command] help</code>  就能查询命令详细用法</p>
<p><strong>示例：创建一个配置作为全局的访问token</strong></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">influx config create --config-name onboarding </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --host-url </span><span class="token string" style="color:#e3116c">&quot;http://192.168.1.198:8086&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--org</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test0&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--token</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;qivXuqFNfILmCjlMq-bQ4mXyLQXTDignFqFagc7DQkqxWps880UPtnZZsoHwIjT7uN1J0MaAavsZjGk2xqLk4g==&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## --active: 将此配置设为活动配置，意味着后续的 InfluxDB CLI 操作将默认使用该配置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因为在flux cli中访问资源，必须要指定组织和token，上一个命令就是创建token并设置为默认。比如</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@influxdb sampleData</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># influx bucket ls --org test0 --token Wftn6R5gqz23mMBBHNi1MD48uNYmX4KvYRxBJcifW3uPR8wI6Z-NgyDDEWRbLysnrFA809cVHu496sF-N6pvwA==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ID                      Name            Retention       Shard group duration    Organization ID         Schema Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b20b25c61bbeae97        _monitoring     168h0m0s        24h0m0s                 b8c302eb7f930bdf        implicit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">58f00b1d7016d660        _tasks          72h0m0s         24h0m0s                 b8c302eb7f930bdf        implicit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e1fa6a9ba4b0f0d3        test0           infinite        168h0m0s                b8c302eb7f930bdf        implicit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>test0</code>和<code>Wftn6R5gqz23mMBBHNi1MD48uNYmX4KvYRxBJcifW3uPR8wI6Z-NgyDDEWRbLysnrFA809cVHu496sF-N6pvwA==</code> 是我安装时用户密码初始化的组织和生成的token。当没有指定token时就无法访问bucket资源，所以就必须手动输入org和token。</p>
<ul>
<li><strong>Organization(org)</strong> 表示一个逻辑分组，用于将用户、存储桶（buckets）、仪表板和其他资源组 织在一起。一个 InfluxDB 实例可以包含多个组织，每个组织可以有自己的用户和资源。你可以隔离和管理不同团队或项目的数据和用户，不同组织中的资源是相互隔离的，用户只能访问他们所属组织的资源。</li>
<li><strong>Token</strong> 是用于身份验证和授权的密钥。在 InfluxDB 中，每个操作都需要通过令牌进行身份验证，以确保只有授权用户才能执行操作。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker部署">docker部署<a href="#docker部署" class="hash-link" aria-label="docker部署的直接链接" title="docker部署的直接链接">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull influxdb:2.7.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--name</span><span class="token plain"> influxdb </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8086</span><span class="token plain">:8086 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/data:/var/lib/influxdb2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string environment constant" style="color:#36acaa">$PWD</span><span class="token string" style="color:#e3116c">/config:/etc/influxdb2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOCKER_INFLUXDB_INIT_MODE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">setup </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOCKER_INFLUXDB_INIT_USERNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">liufei </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOCKER_INFLUXDB_INIT_PASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Lf123456 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOCKER_INFLUXDB_INIT_ORG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">liufeiOrg </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DOCKER_INFLUXDB_INIT_BUCKET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">startBucket </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  influxdb:2.7.10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="influx核心概念">Influx核心概念<a href="#influx核心概念" class="hash-link" aria-label="Influx核心概念的直接链接" title="Influx核心概念的直接链接">​</a></h2>
<p><strong>InfluxDB不同于Sql</strong></p>
<p>在InfluxDB中，一切的数据都标记了时间，并且不需要提前定义数据格式。</p>
<p>InfluxDB是针对时间序列数据进行了优化的数据库。这些数据通常来自分布式传感器组，来自大型网站的点击数据或金融交易列表等。这个数据有一个共同之处在于它只看一个点没什么用。一个读者说，在星期二UTC时间为12:38:35时根据他的电脑CPU利用率为12％，这个很难得出什么结论。只有跟其他的series结合并可视化时，它变得更加有用<strong>这就是influxdb关注的是数据集合，而不是单个的数据行或者值，这也就是为什么influxdb 不是一个带了时间列的关系型数据库</strong>。随着时间的推移开始显现的趋势，是我们从这些数据里真正想要看到的。另外，时间序列数据通常是一次写入，很少更新。</p>
<p>结果是，由于优先考虑create和read数据的性能而不是update和delete，InfluxDB不是一个完整的CRUD数据库，更像是一个CR-ud。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-elements">data elements<a href="#data-elements" class="hash-link" aria-label="data elements的直接链接" title="data elements的直接链接">​</a></h3>
<p><a href="https://docs.influxdata.com/influxdb/v2/reference/key-concepts/data-elements/" target="_blank" rel="noopener noreferrer">参考文档</a></p>
<ul>
<li>
<p><strong>Timestamp</strong> : InfluxDB 中存储的所有数据都有一个<code>_time</code>存储时间戳的列。在磁盘上，时间戳以纪元纳秒格式存储。InfluxDB 格式化时间戳以<a href="https://docs.influxdata.com/influxdb/v2/reference/glossary/#rfc3339-timestamp" target="_blank" rel="noopener noreferrer">RFC3339</a> UTC 显示与数据相关的日期和时间。写入数据时，时间戳精度非常重要。</p>
</li>
<li>
<p>非必填，如果未提供时间戳，InfluxDB 将使用其主机的系统时间 (UTC)。</p>
</li>
<li>
<p><strong>Measurement</strong>: 测量名称是字符串，区分大小写，充当标签、字段和时间戳的容器，一个measurement相当于mysql中的一张表，但不同于mysql需要提前定义表结构，influxdb不需要提前定义measurement。</p>
</li>
<li>
<p><strong>Fields</strong></p>
</li>
<li>
<p>必填，一行数据中至少包含一个field</p>
</li>
<li>
<p>Field key: 字段键是一个字符串，代表字段的名称</p>
</li>
<li>
<p>Field value : 字段值表示关联字段的值。字段值可以是 <em><a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#float" target="_blank" rel="noopener noreferrer">浮点型</a>|<a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#integer" target="_blank" rel="noopener noreferrer">整数</a>| <a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#uinteger" target="_blank" rel="noopener noreferrer">UInteger</a> |<a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#string" target="_blank" rel="noopener noreferrer">字符串</a>|<a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#boolean" target="_blank" rel="noopener noreferrer">布尔值</a></em>。</p>
</li>
<li>
<p>Field set: 字段集是与时间戳关联的字段键值对的集合。</p>
</li>
</ul>
<p><strong>InfluxDB 数据中字段是必需的，并且未索引。过滤字段值的查询必须扫描所有字段值以匹配查询条件。因此，对标签的查询比对字段的查询性能更高</strong></p>
<ul>
<li>
<p><strong>Tags</strong> ：标签包括标签键<code>Tag key</code>和标签值<code>Tag value</code>，以字符串和元数据形式存储。</p>
</li>
<li>
<p>非必填</p>
</li>
<li>
<p>标签键值都是字符串</p>
</li>
<li>
<p>键值关系用<code>=</code>操作数表示。多个标签键值对以逗号分隔。 <em>标签键和标签值区分大小写</em></p>
</li>
<li>
<p><em>标签值不能为空；如果标签为空，则标签集中直接不要包含此标签</em></p>
</li>
</ul>
<p><strong>标签是非必填的。不需要在数据结构中添加标签，但最好包含标签，由于 InfluxDB 会索引标签，因此查询引擎无需扫描存储桶中的每条记录来查找标签值。</strong></p>
<ul>
<li>
<p><strong>Series</strong>:</p>
</li>
<li>
<p>series key： a unique combination of measurement and tag set。一个measurement和一个标签集合的组合。</p>
</li>
</ul>
<table><thead><tr><th>measurement</th><th>tag set</th></tr></thead><tbody><tr><td>census</td><td>location=klamath,scientist=anderson</td></tr><tr><td>census</td><td>location=portland,scientist=mullen</td></tr></tbody></table>
<ul>
<li>series: A <em>series</em> includes timestamps and field values for a given series key。一个series key和一组时间以及对应field value的集合</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">census,location</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">klamath,scientist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">anderson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-08-18T00:00:00Z </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-08-18T00:06:00Z </span><span class="token number" style="color:#36acaa">28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意：series是不按field组合的，即当有多个field的列时也是不影响influxdb实际存储和聚合处理，Series仍然不变。</strong></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 多个field不影响series的组合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">census,location</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">klamath,scientist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">anderson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-08-18T00:00:00Z </span><span class="token number" style="color:#36acaa">23</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-08-18T00:06:00Z </span><span class="token number" style="color:#36acaa">28</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意：当一个measurement中某个tag只有部分数据有时，influxdb在处理时会将这些数据点分配到不同的 series。这是因为 series key 是由 measurement 名称和所有非空 tag 组合而成的。因此，不同的 tag 组合会导致不同的 series key，从而创建不同的 series。此处和mysql的查询条件不同，当tag1=value1的series的数据中是不包含其他任何tag的数据，（只有一个tag查询条件时，就如同mysql中默认都加上了[and other column is null...]的条件），即InfluxDB在查询时针对单个最细粒度的series进行操作，而无法直接在一个查询中对多个series进行聚合操作。要类似mysql那样，只能通过执行多个查询来获取不同series的数据，然后在客户端进行进一步的处理和聚合。</strong></p>
<p><strong>tag的值会影响series的数量，但field不管是字段数量还是值的数量都不会影响series的数量</strong></p>
<ul>
<li>
<p>Series 是一个很重要的概念，同时过多的series组合会导致很多问题，参考：<a href="https://docs.influxdata.com/influxdb/v2/write-data/best-practices/resolve-high-cardinality/" target="_blank" rel="noopener noreferrer">Resolve high series cardinality</a></p>
</li>
<li>
<p><strong>Point</strong>: A <strong>point</strong> includes the series key, a field value, and a timestamp–for example</p>
</li>
</ul>
<p>在InfluxDB中，point表示单个数据记录，类似于SQL数据库表中的行。 每个point：</p>
<ul>
<li>由一个measurement、一个tag set、一个field key、一个field value和一个timestamp组成。</li>
<li>由series和timestamp唯一标识。</li>
</ul>
<blockquote>
<p>2019-08-18T00:00:00Z census ants 30 portland mullen</p>
<p>注意，<strong>一个point中允许包含多个field和field value</strong></p>
</blockquote>
<ul>
<li><strong><a href="https://docs.influxdata.com/influxdb/v2/reference/key-concepts/data-elements/#bucket" target="_blank" rel="noopener noreferrer">Bucket</a></strong> : 所有 InfluxDB 数据都存储在 bucket 中。bucket结合了数据库和保留期的概念。bucket 属于组织</li>
</ul>
<blockquote>
<p>**注意：**Bucket 是 InfluxDB 2.x 中的数据存储单位，类似于 InfluxDB 1.x 中的 <strong>数据库（database）</strong> 和 <strong>保留策略（retention policy）</strong> 的结合体。它用于存储时间序列数据，并且为存储在其中的数据提供了数据的保留时长（retention period）。即你可以为每个 bucket 设置数据的保存时间，超出时间的数据会自动删除。并且每个 bucket 可以包含多个 <strong>measurement</strong>，即不同类型的数据表。</p>
<p>单个 InfluxDB 2.7 OSS 实例支持在所有组织中主动写入或查询大约 20 个存储桶。超过这个数量可能会对性能产生不利影响</p>
</blockquote>
<ul>
<li>**<a href="https://docs.influxdata.com/influxdb/v2/reference/key-concepts/data-elements/#organization" target="_blank" rel="noopener noreferrer">Organization</a> : <strong>组织是一组</strong><a href="https://docs.influxdata.com/influxdb/v2/admin/users/" target="_blank" rel="noopener noreferrer">用户</a>**的工作区。所有<a href="https://docs.influxdata.com/influxdb/v2/visualize-data/dashboards/" target="_blank" rel="noopener noreferrer">仪表板</a>、<a href="https://docs.influxdata.com/influxdb/v2/process-data/" target="_blank" rel="noopener noreferrer">任务</a>、存储桶和用户都属于一个组织，通过Org的概念，可以将不同的用户、Bucket（数据库）、Token（访问令牌）、Dashboard（仪表盘）等资源分配给特定的组织。这样，可以避免不同用户或团队之间的数据冲突，并且能够进行更好的权限管理。并且在 InfluxDB 中，API Token 和权限（读、写等）都是与特定的 Org 绑定的。每个 Token 都属于某个 Org，并且只对该 Org 中的资源（如 Bucket、Dashboard 等）有效。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="influxdb数据格式补充">influxdb数据格式补充<a href="#influxdb数据格式补充" class="hash-link" aria-label="influxdb数据格式补充的直接链接" title="influxdb数据格式补充的直接链接">​</a></h3>
<p><a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#naming-restrictions" target="_blank" rel="noopener noreferrer">参考文档</a></p>
<p>influxdb数据格式在上面的字段定义中，做了定义，下面再做一些补充。</p>
<ul>
<li>InfluxDB 使用<code>Line protocol</code>写入数据。它是一种基于文本的格式，提供数据点的测量值、标签集、字段集和时间戳。</li>
</ul>
<div class="language-scss codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scss codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;measurement&gt;[,&lt;tag_key&gt;=&lt;tag_value&gt;[,&lt;tag_key&gt;=&lt;tag_value&gt;]] &lt;field_key&gt;=&lt;field_value&gt;[,&lt;field_key&gt;=&lt;field_value&gt;] [&lt;timestamp&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myMeasurement,tag1=value1,tag2=value2 fieldKey=&quot;fieldValue&quot;,fieldKey1=&quot;fieldValue1&quot; 1556813561098000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>数据行由换行符<code>\n</code>分隔，数据行里面的标签或字段值中不能有换行符</strong></p>
</li>
<li>
<p>Measurement names, tag keys, and field keys 不能包含下划线 <code>_</code>。 <code>_</code> namespace is reserved for InfluxDB system use。</p>
</li>
<li>
<p>空格严格要求，<code>Line protocol</code>规定了 InfluxDB 如何解释数据点，<strong>第一个未转义的空格</strong>将测量值和标签集与字段集分隔开。<strong>第二个未转义的空格</strong>将字段集与时间戳分隔开。</p>
</li>
<li>
<p>时间戳。默认精度为纳秒 ( <code>ns</code>)。纳秒，一秒的十亿分之一（1 ns = 10^-9 s）。毫秒，一秒的千分之一（1 ms = 10^-3 s）。范围：<code>-9223372036854775806</code>-<code>9223372036854775806</code></p>
</li>
<li>
<p><code>#</code>行首解释为注释字符，并忽略所有后续字符，直到下一个换行符<code>\n</code>。</p>
</li>
<li>
<p>数据由测量名称、标签集和时间戳唯一标识。如果采集的数据具有相同的测量、标签集和时间戳，但具有不同的字段集，<strong>则该字段集将成为旧字段集和新字段集的并集</strong>，而且”any conflicts favor the new field set.“</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="influxdb-设计原则"><a href="https://docs.influxdata.com/influxdb/v2/reference/key-concepts/design-principles/#time-ordered-data" target="_blank" rel="noopener noreferrer">InfluxDB 设计原则</a><a href="#influxdb-设计原则" class="hash-link" aria-label="influxdb-设计原则的直接链接" title="influxdb-设计原则的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1按时间升序写入">1、按时间升序写入<a href="#1按时间升序写入" class="hash-link" aria-label="1、按时间升序写入的直接链接" title="1、按时间升序写入的直接链接">​</a></h4>
<p>为了提高性能，数据按时间升序写入。主要的原因如下：</p>
<p><strong>顺序写入优化磁盘性能</strong>:</p>
<ul>
<li><strong>磁盘顺序写入</strong>：磁盘在进行顺序写入时性能最佳。 顺序写入能够最大化写入带宽，减少寻道时间和写入延迟。</li>
<li><strong>降低碎片化</strong>：时间升序写入使数据在磁盘上按时间顺序存储，减少了数据的碎片化，有助于提高读写性能和磁盘利用率。<em>注：磁盘碎片化是指数据在磁盘上的存储位置变得不连续，导致读写操作需要更多的磁盘寻道时间。碎片化会降低磁盘的读写效率，特别是在机械硬盘（HDD）上表现尤为明显</em></li>
</ul>
<p><strong>压缩效率</strong>:</p>
<ul>
<li><strong>时间序列数据压缩</strong>：时间升序写入的数据通常具有较高的相关性和相似性，这有助于实现更高效的压缩。压缩算法可以更有效地处理连续和递增的数据，从而减少存储空间占用。</li>
</ul>
<p><strong>索引管理</strong>:</p>
<ul>
<li><strong>索引构建效率</strong>：在时间序列数据库中，索引通常基于时间戳构建。时间升序写入使索引能够按顺序构建和更新，避免了频繁的索引重组，提高了索引管理的效率。</li>
<li><strong>查询优化</strong>：时间升序写入使得时间范围查询可以更高效地定位和读取数据块，因为数据按时间顺序存储，可以快速跳过不相关的数据块。</li>
</ul>
<p><strong>缓存和内存管理</strong>:</p>
<ul>
<li><strong>写入缓存命中率</strong>：时间升序写入可以提高写入缓存的命中率，因为相邻的时间数据往往会一起写入。这减少了写入缓存的刷新频率，提高了写入性能。</li>
<li><strong>减少随机写入的开销</strong>：随机写入会导致内存和缓存频繁刷新和替换，增加了内存和缓存管理的开销。顺序写入减少了这种开销，从而提高了整体性能。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2严格的更新和删除权限">2、严格的更新和删除权限<a href="#2严格的更新和删除权限" class="hash-link" aria-label="2、严格的更新和删除  权限的直接链接" title="2、严格的更新和删除权限的直接链接">​</a></h4>
<p>为了提高查询和写入性能，InfluxDB 严格限制<strong>更新</strong>和<strong>删除</strong>权限。时间序列数据主要是从未更新的新数据。删除通常只会影响未写入的数据，并且永远不会发生有争议的更新-<em>（我理解就是influxdb不考虑并发安全的问题）</em>。</p>
<p>更新和删除数据，会显著的影响influxdb的性能，原因如下：</p>
<p><strong>更新的实际处理过程</strong></p>
<ul>
<li>标记旧数据：InfluxDB设计上，数据是不可变的，更新实际上是添加新数据点并将旧数据点标记为无效。这导致在物理存储上同一数据记录会有多个版本，旧版本虽然被标记为无效，但仍然占用存储空间。</li>
<li>追加新数据：每次更新操作实际上都是在数据块的末尾添加新的数据，原始数据并不会被覆盖或移动，这导致数据在物理存储上的分布变得不连续。</li>
</ul>
<p><strong>删除的实际处理过程</strong></p>
<ul>
<li>标记删除：数据被删除时，通常只是标记为删除而不会立即物理删除。随着时间推移，这些标记删除的数据点会分布在各个数据块中，形成碎片。标记会影响查询性能，因为查询需要过滤掉标记为删除的数据。</li>
<li>垃圾回收：垃圾回收机制会定期扫描和清理这些标记为删除的数据。清理操作会导致数据块的重新组织，但仍然可能留下零散的空白区域，导致碎片化。同时定期的垃圾回收进程会扫描和清理标记为删除的数据，释放存储空间。这一过程可能会消耗大量的I/O资源和CPU时间，影响其他正常的读写操作。</li>
<li><strong>索引重建</strong>：删除操作需要更新索引结构，确保删除的数据点不会出现在查询结果中。频繁的删除操作会导致索引重建和维护的开销增加，影响整体查询性能。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3读写查询优先而不是强一致性">3、读写查询优先而不是强一致性<a href="#3读写查询优先而不是强一致性" class="hash-link" aria-label="3、读写查询优先而不是强一致性的直接链接" title="3、读写查询优先而不是强一致性的直接链接">​</a></h4>
<p>InfluxDB 优先处理读写请求，而不是强一致性。执行查询时，InfluxDB 会返回结果。任何影响查询数据的事务都会随后处理，以确保数据最终一致。因此，如果提取率很高（每毫秒多次写入），查询结果可能不包含最新数据。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4无模式设计schemaless-design">4、无模式设计（Schemaless design）<a href="#4无模式设计schemaless-design" class="hash-link" aria-label="4、无模式设计（Schemaless design）的直接链接" title="4、无模式设计（Schemaless design）的直接链接">​</a></h4>
<p>InfluxDB 使用无模式设计来更好地管理不连续数据。时间序列数据通常是短暂的，这意味着数据会出现几个小时，然后就消失了。例如，一个新主机启动并报告一段时间，然后关闭。</p>
<p>数据库不需要预定义的模式来存储数据。这种设计具有高度的灵活性和动态性，允许用户随时插入数据而不需要提前定义数据的结构。</p>
<ul>
<li>
<p><strong>动态列</strong>:在InfluxDB中，fields和tags不需要提前定义。每个数据点可以有不同的fields和tags，这使得用户可以根据需要动态地添加新的列（fields和tags）。</p>
</li>
<li>
<p><strong>自动创建</strong>:当写入新数据点时，如果指定的measurement、field或tag不存在，InfluxDB会自动创建它们。这简化了数据写入操作，无需在数据库级别进行任何前期配置。</p>
</li>
<li>
<p><strong>灵活的数据模型</strong>:数据模型非常灵活，可以随着数据的变化而变化。不同的measurement可以有 不同的tags和fields，甚至在同一个measurement中，不同的数据点也可以有不同的fields和tags。</p>
</li>
</ul>
<p>例如，在InfluxDB中，你可以直接写入如下两个数据点，即使它们的fields和tags不同：</p>
<div class="language-tex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest temperature=82,humidity=71 1465839830100400200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-east,season=winter temperature=30 1465839830100400201</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>第一个数据点包含了<code>temperature</code>和<code>humidity</code>两个fields，并且只有一个<code>location</code> tag。</li>
<li>第二个数据点包含了<code>temperature</code> field，有两个tags：<code>location</code>和<code>season</code>。</li>
</ul>
<p>这两个数据点都属于<code>weather</code> measurement，但它们的结构不同。InfluxDB能够自动处理这种差异，无需用户进行任何额外的配置。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5数据集胜过单 个数据datasets-over-individual-points">5、数据集胜过单个数据（Datasets over individual points）<a href="#5数据集胜过单个数据datasets-over-individual-points" class="hash-link" aria-label="5、数据集胜过单个数据（Datasets over individual points）的直接链接" title="5、数据集胜过单个数据（Datasets over individual points）的直接链接">​</a></h4>
<p>由于数据集比单个点更重要，因此 InfluxDB 实现了强大的工具来聚合数据并处理大型数据集。点通过时间戳和系列进行区分，因此没有传统意义上的 ID。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6重复数据">6、重复数据<a href="#6重复数据" class="hash-link" aria-label="6、重复数据的直接链接" title="6、重复数据的直接链接">​</a></h4>
<p>为了简化冲突解决并提高写入性能，InfluxDB 假设多次发送的数据是重复数据。相同的点不会被存储两次。如果为某个点提交了新的字段值，InfluxDB 会使用最新的字段值更新该点。</p>
<p><a href="https://docs.influxdata.com/influxdb/v2/write-data/best-practices/duplicate-points/" target="_blank" rel="noopener noreferrer">duplicate-points</a></p>
<p><strong>influxdb的数据去重策略</strong></p>
<blockquote>
<p>A point is uniquely identified by the measurement name, tag set, and timestamp. If you submit line protocol with the same measurement, tag set, and timestamp, but with a different field set, the field set becomes the union of the old field set and the new field set, where any conflicts favor the new field set.</p>
</blockquote>
<p>这个关于重复数据的<a href="https://docs.influxdata.com/influxdb/v2/reference/syntax/line-protocol/#duplicate-points" target="_blank" rel="noopener noreferrer">Duplicate points</a> 的描述，需要再举个例子：</p>
<p>假设有以下数据点：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest temperature=82 1465839830100400200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果提交以下数据点：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest humidity=71 1465839830100400200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终的结果将是：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest temperature=82,humidity=71 1465839830100400200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里将字段集合做了合并</p>
<p>但是，如果提交以下数据点：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest temperature=85 1465839830100400200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终的结果将是：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">weather,location=us-midwest temperature=85 1465839830100400200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因为新的 temperature 值（85）覆盖了旧的值（82）。这里新的值覆盖了旧的值，**注意无论时间戳是历史时间还是当前时间，InfluxDB 都会采用相同的处理策略。**当提交具有相同 measurement 名称、tag set 和时间戳的数据点时，新的 field set 将与现有的 field set 合并，并且新数据中的 field 值将覆盖旧数据中的同名 field 值。</p>
<p>具体来说，无论时间戳是否是历史时间，处理流程如下：</p>
<ol>
<li><strong>相同 measurement 名称、tag set 和时间戳</strong>：判断新提交的数据点是 否与已有数据点的 measurement 名称、tag set 和时间戳相同。</li>
<li><strong>合并 field set</strong>：将新数据点的 field set 与已有数据点的 field set 合并。</li>
<li><strong>冲突处理</strong>：在合并过程中，任何 field 名称冲突都将以新数据点的 field 值为准，覆盖已有数据点的同名 field 值。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tsmtsi">TSM/TSI<a href="#tsmtsi" class="hash-link" aria-label="TSM/TSI的直接链接" title="TSM/TSI的直接链接">​</a></h3>
<p>InfluxDB <a href="https://docs.influxdata.com/influxdb/v2/reference/key-concepts/data-elements/" target="_blank" rel="noopener noreferrer">data elements</a> are stored in <strong>time-structured merge tree (TSM)</strong> and <strong>time series index (TSI)</strong> files to efficiently compact stored data.</p>
<p>在InfluxDB 2.0及其之后的版本中，底层的数据存储格式仍然是TSM（Time-Structured Merge Tree）。TSM 文件格式是 InfluxDB 存储时序数据的主要方式，它通过高效的时间序列数据存储和检索来实现高性能和高压缩率。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="存储模型">存储模型<a href="#存储模型" class="hash-link" aria-label="存储模型的直接链接" title="存储模型的直接链接">​</a></h4>
<p>tsm在整体上类似于类似于LSM (Log structured merge tree) ，可以说就是针对时间序列优化的LSM结构。</p>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/learn-lsm-tree-read.png" alt="image" style="max-width:60%;height:auto;display:block;margin:0 auto"></div>
<p>也包含如下结构</p>
<ul>
<li><strong>WAL（write Ahead Log)</strong></li>
</ul>
<p>插入数据时先顺序写入 WAL 文件中保证数据的持久化，再写入内存中 MemTable 中。日志文件都是顺序写，速度很快。当程序挂掉重启时，可以从 WAL 文件中重新恢复内存中的 MemTable。</p>
<ul>
<li><strong>MemTable</strong></li>
</ul>
<p>MemTable 对应的就是 WAL 文件，是该文件内容在内存中的存储结构，通常用 SkipList 来实现。MemTable 提供了 k-v 数据的写入、删除以及读取的操作接口。其内部将 k-v 对按照 key 值有序存储，这样方便之后快速序列化到 SSTable 文件中，仍然保持数据的有序性。</p>
<ul>
<li><strong>Immutable Memtable</strong></li>
</ul>
<p>就是在内存中只读的 MemTable，由于内存是有限的，通常我们会设置一个阈值，一般是2m，当 MemTable 占用的内存达到阀值后就自动转换为 Immutable Memtable，Immutable Memtable 和 MemTable 的区别就是它是只读的，系统此时会生成新的 MemTable 供写操作继续写入。使用 Immutable Memtable，就是为了避免将 MemTable 中的内容序列化到磁盘中时会阻塞写操作。</p>
<ul>
<li><strong>SSTable(Sorted String Table)</strong></li>
</ul>
<p>SSTable 就是 MemTable 中的数据在磁盘上的有序存储，其内部数据是根据 key 从小到大排列的。通常为了加快查找的速度，需要在 SSTable 中加入数据索引，可以快读定位到指定的 k-v 数据。</p>
<p>series结构如下：</p>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/tsm-structure.png" alt="image" style="max-width:80%;height:auto;display:block;margin:0 auto"></div>
<p><strong>即这里TSM首先是根据 Series Key 来分组和排序，然后在每个 Series Key 内按时间戳排序数据点</strong>。</p>
<blockquote>
<p>内存中实际上就是一个<code>Map&lt;SeriesKey, List&lt;Timestamp|field value&gt;&gt;</code>，Map中一个SeriesKey对应一个List，List中存储时间线数据。数据进来之后根据 measurement+ tags组合成SeriesKey，再将<code>Timestamp|Value</code>组合值写入时间线数据List中，即每个 series 存储了相同 measurement 和 tags 组合下的 fields 数据。内存中的数据flush的文件后，同样会将同一个SeriesKey中的时间线数据写入同一个Block块内。</p>
<p>注意上图中的，<strong>每个SeriesKey都是唯一的组合，代表一个独立的时间序列</strong>。比如，<code>Series Key(measurement=&quot;cpu&quot;, tagA=&quot;server1&quot;, tagB=&quot;region1&quot;)</code>是不会包含<code>Series Key(measurement=&quot;cpu&quot;, tagA=&quot;server1&quot;, tagB=&quot;region1&quot;, tagC=&quot;datacenter1&quot;)</code>的数据的，它们是两个不同的时间序列，彼此互不包含。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="文件系统的布局">文件系统的布局<a href="#文件系统的布局" class="hash-link" aria-label="文件系统的布局的直接链接" title="文件系统的布局的直接链接">​</a></h4>
<p><a href="https://docs.influxdata.com/influxdb/v2/reference/internals/file-system-layout/" target="_blank" rel="noopener noreferrer">reference</a></p>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/influxdb-tsi-file.png" alt="image" style="max-width:50%;height:auto;display:block;margin:0 auto"></div>
<p>基于TSI的InfluxDB索引组织图（如上所示）。其中db（数据库）、rp（存储策略）、shard、Index在文件组织下都是以目录形式表现，TSI使用了分区策略，所以在Index文件夹下是0~7共计8个partition文件夹（<em>索引的分区数量默认是8，数量可以配置的，并且是固定的不会随着数据量的增加而改变。series 的分区数量通常也与 index 的分区数量一致。这样设计是为了确保数据的高效管理和查询性能。</em>），partition文件夹则是TSI文件与它的WAL（TSL）。
<strong>什么是shard：</strong></p>
<p>Shard 是 InfluxDB 用来存储特定时间范围内数据的基本存储单元。每个 shard 包含了一个时间范围内的所有数据。时间范围由 shard duration（分片持续时间）决定。这个持续时间可以根据数据库的存储需求进行配置。默认情况下，对于 &quot;autogen&quot; <code>retention policy</code>（保留策略），shard duration 通常是 7 天。</p>
<p>每个 shard 被存储为一个独立的文件，包含了所有属于该时间范围的数据。Shard 文件使用 TSM（Time-Structured Merge）树格式，这是一种高效的时序数据存储格式。</p>
<p><strong>什么是shard group</strong>：</p>
<p>Shard Group 是一个逻辑概念，而 Shard 则在文件系统中有实际对应的文件夹。并且<code>shard duration</code>和<code>shardGroupDuration</code>基本是一致的。<code>shardGroupDuration</code>是根据<code>retention policy</code>的<code>duration</code>计算得来，不过也可以在创建<code>retention policy</code>指定。</p>
<p>在 InfluxDB 中，<code>autogen</code>（ <code>autogen</code> 是默认的保留策略）目录下的数字文件夹代表 Shard ID，每个文件夹是一个独立的 Shard。多个 Shard 组成一个 Shard Group，通过 Shard Group Duration 来决定每个 Shard Group 覆盖的时间范围。</p>
<p><strong>shard id：</strong></p>
<p>在 InfluxDB 中，每个 shard 都有一个全局唯一的 ID（shard ID）,在整个 InfluxDB 集群中是唯一的。无论数据是在哪个数据库、在哪个保留策略中，这个 ID 都不会重复。当执行数据查询、删除或其它操作时，系统会通过 shard ID 定位到对应的 shard。并且shard ID 通常是递增的，每当创建一个新的 shard 时，都会分配一个比之前所有 shard ID 都大的新 ID。一旦分配后就不会改变，且 shard 中的数据可以不断更新。</p>
<p><strong>为什么要设计shard：</strong></p>
<p><code>shard</code>其实就是<code>TSM</code>存储引擎的具体实现，数据的写入、更新、删除等操作会在对应的 shard 中进行处理和实现。数据的查询、聚合、压缩等功能也都在 shard 中具体实现。并且使用 shard 分片技术，可以有效地管理大量的时间序列数据，并确保数据按时间顺序存储和高效查询。<strong>shard的数量是不固定的</strong>，随  着时间的推移，当前时间的数据会被动态地写入到相应的 shard 中。这也就是为什么<code>retention policy</code>对应的是<code>shardGroupDuration</code>，而不是shard。InfluxDB 根据数据的写入和时间范围的设置动态创建和管理 shard。每个 shard 负责存储一定时间范围内的数据。当新的数据写入到 InfluxDB 时，系统会根据配置的策略（<em>比如：当时间范围超过预设的阈值时，当一个 shard 过大时，为避免单个 shard 过大而影响系统性能和数据管理的效率</em>）判断是否需要创建新的 shard 来存储这些数据。旧的 shard 在达到设定的数据保留期限后，可能会被删除或者进行归档处理，以释放空间或保留历史数据。动态管理 shard 可以有效地控制每个 shard 的大小和数据量，保持系统的性能和查询效率。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据模型">数据模型<a href="#数据模型" class="hash-link" aria-label="数据模型的直接链接" title="数据模型的直接链接">​</a></h4>
<p>上面说了InfluxDB 的数据文件是如何组织的，下面说一下具体的数据模型，其元数据是 tag-field 模型，下面是两张influxdb的统计数据示例：</p>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/influxdb-data.png" alt="image" style="max-width:50%;height:auto;display:block;margin:0 auto"></div>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/tsm-data-structure.png" alt="image" style="max-width:50%;height:auto;display:block;margin:0 auto"></div>
<ul>
<li>
<p>Measurement：类似SQL中表的概念</p>
</li>
<li>
<p>Tags：维度列</p>
</li>
<li>
<p>上图中location和scientist分别是表中的两个Tag Key，其中location对应的维度值Tag Values为<code>｛1, 2｝</code>，scientist对应的维度值Tag Values为<code>{langstroth, perpetual}</code>，两者的组合TagSet有四种：</p>
</li>
<li>
<p>在InfluxDB  中，表中Tags组合会被作为记录的主键，因此主键并不唯一，比如上表中第一行和第三行记录的主键都为’location=1,scientist=langstroth’。所有时序查询最终都会基于主键查询之后再经过时间戳过滤完成。</p>
</li>
<li>
<p>Fields：数值列。数值列存放用户的时序数据。</p>
</li>
<li>
<p>Point：类似SQL中一行记录，而并不是一个点。</p>
</li>
</ul>
<blockquote>
<p>注意：在 InfluxDB 中field是不作索引的 ，并且当一个数据点包含多个 field 时，这些 field 是作为一个整体存储在一起的。一个数据点包含 measurement、tags、fields 和 timestamp，并作为一个单元存储在 TSM 文件中。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="field的内部处理">field的内部处理<a href="#field的内部处理" class="hash-link" aria-label="field的内部处理的直接链接" title="field的内部处理的直接链接">​</a></h4>
<p>在 InfluxDB 中，是允许多个field字段的，在处理多个字段（fields）时，influxdb会在内部维护一个元数据存储结构，记录每个 measurement 下所有字段的名称和数据类型，这些元数据使得 InfluxDB 能够知道每个 measurement 包含的字段以及它们的数据类型。</p>
<p><strong>元数据结构</strong>：InfluxDB 使用内部元数据存储结构，通常是树状或映射结构，记录每个 measurement 包含的字段及其类型。例如：<code>measurement -&gt; fields</code> 这样的映射。</p>
<p><strong>查询优化</strong>：在查询解析阶段，通过元数据快速了解字段的存在性和类型，避免不必要的数据块读取和类型转换。利用元数据结构，InfluxDB 能够高效地定位和过滤数据点，提高查询性能。</p>
<p><strong>元数据管理：</strong></p>
<ul>
<li>当写入数据时，如果在一个已有的时间序列中新增了一个字段，InfluxDB会将这个字段的数据添加到相应的时间序列中。InfluxDB会自动更新其元数据以包含新的字段。新的字段会与已有的字段一起存储在同一个时间序列中。</li>
<li>一旦一个 field key 在某个 measurement 中被定义并写入了数据，所有后续写入到同一 measurement 的相同 field key 的数据点，必须保持数据类型一致。</li>
<li>如果尝试写入的数据类型与已有类型不一致，InfluxDB 将拒绝该数据点的写入，并返回错误。这一机制确保了数据的类型一致性和查询的准确性。例如，如果 <code>cpu</code> measurement 中的 <code>usage</code> 字段被定义为 <code>float</code> 类型，那么所有后续写入 <code>cpu</code> measurement 的数据点中，<code>usage</code> 字段都必须是 <code>float</code> 类型。如果尝试写入的数据点包含的字段类型与已有的字段类型不一致，InfluxDB 将拒绝写入，并返回错误。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="检索优化">检索优化<a href="#检索优化" class="hash-link" aria-label="检索优化的直接链接" title="检索优化的直接链接">​</a></h4>
<p>influxdb针对查询是做了很多设计和优化的</p>
<p><strong>有序存储</strong>：</p>
<p>InfluxDB 的时间序列数据是按时间戳有序存储的，这有助于高效地进行时间范围查询。并且在 InfluxDB 中，数据的更新、删除（更新和删除都是写入新的记录，而不是改变原来的记录，删除就是增加数据删除标记，而不是实际删除记录）和添加操作在操作时都是顺序写入的，首先写入 WAL 文件，然后更新到 MemTable，最终写入 TSM 文件。最后后台的合并过程（Compaction）会将这些操作整合到历史时间段的文件中。换句话说，不管后续对历史时间段数据的添加和修改，都不会改变influxdb存储按时间戳排序的文件结构。</p>
<p><strong>稀疏索引</strong>：</p>
<p>稀疏索引在 TSM (Time-Structured Merge) 文件中用于快速定位数据块。这些索引条目不会为每条数据点创建索引，而是为特定的时间段或关键点创建索引。通过稀疏索引，InfluxDB 可以快速确定所需数据点所在的数据块的范围。</p>
<p><strong>布隆过滤器</strong>：布隆过滤器是一种空间效率高的概率数据结构，用于测试一个元素是否属于一个集合。在 InfluxDB 中，布隆过滤器用于判断特定的 key 是否存在于某个 TSM 文件中。布隆过滤器能够快速排除某些不包含所查询 key 的数据块，从而减少不必要的磁盘读取操作。</p>
<blockquote>
<p><strong>注意：influxdb中的布隆过滤器，只会针对Tag 和 Measurement ，而不会针对field</strong></p>
</blockquote>
<p><strong>倒排索引：</strong></p>
<p>如果单纯的这种结构其实是不支持多维度查找的，多维度查询influxdb是通过内部实现了倒排索引机制，即实现了tag到SeriesKey的映射关系，如果用户想根据某个tag查找的话，首先根据tag在倒排索引中找到对应的SeriesKey，再根据SeriesKey定位具体的时间线数据。</p>
<blockquote>
<p><strong>注意：influxdb中的倒排索引，也是只会针对Tag 和 Measurement ，而不会针对field</strong></p>
</blockquote>
<p><strong>field查询优化：</strong></p>
<p>field是未做索引的，但field在查询时influxdb也作了优化。主要是通过元数据信息来实现的。</p>
<ul>
<li>
<p>字段存在性检查：通过查询元数据，InfluxDB能够快速确定查询中引用的字段是否存在。这避免了在实际数据块中搜索不存在的字段，从而节省了I/O操作。</p>
</li>
<li>
<p>字段类型检查和转换：字段的类型信息（例如整数、浮点数、字符串等）也存储在元数据中。在查询解析阶段，InfluxDB可以通过元数据确定字段的类型，从而在查询执行时避免不必要的类型转换。</p>
</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> MEAN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">usage_user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> cpu </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;serverA&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> region</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;us_west&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在执行上述查询时，InfluxDB会通过元数据确认<code>usage_user</code>是一个数值类型字段，从而可以直接进行聚合计算。</p>
<ul>
<li>
<p>数据块内过滤：在读取数据块后，InfluxDB仍需在数据块内进行过滤。利用元数  据中的字段信息，可以快速跳过不相关的数据字段，只处理查询涉及的字段。</p>
</li>
<li>
<p>数据写回：数据写回可以视为一种结果缓存的机制。通过将计算或查询的结果写回到数据库中，InfluxDB能够在后续查询中直接使用这些预计算的结果，而不必每次都重新进行复杂的计算和数据处理。这种机制可以显著提高查询性能和响应速度，特别是在处理频繁查询或复杂计算的场景中。</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="与-lsm的区别">与 LSM的区别<a href="#与-lsm的区别" class="hash-link" aria-label="与 LSM的区别的直接链接" title="与 LSM的区别的直接链接">​</a></h4>
<p>LSM Tree和 TSM Tree 都是为了高效处理大规模数据写入而设计的存储结构，只是LSM Tree 是一种通用的存储结构，适用于多种应用场景，而 TSM Tree 则是专门为时间序列数据优化的存储结构，特别适合需要高效处理和查询时间序列数据的应用。两者的整体架构和存储结构都比较类似。</p>
<p><strong>相同点</strong></p>
<ol>
<li>不可变数据结构：都使用不可变的数据结构。数据一旦写入磁盘，就不会被修改，而是通过合并生成新的文件。这种设计简化了并发控制，并提高了写入性能。</li>
<li>写入路径：数据首先写入内存中的数据结构（如memtable或缓存），然后批量写入磁盘，生成有序的文件（如SSTable或TSM文件）。这种批量写入方式优化了写性能并减少了随机I/O操作。</li>
<li>分层存储和合并：数据存储在多个文件中，这些文件按照一定规则进行分层和合并。后台进程负责合并较小的文件，生成新的、更大的文件，以减少文件数量和提高查询性能。</li>
<li>高效索引：两者都使用索引结构（如布隆过滤器和稀疏索引）来加速查询，减少不必要的磁盘读取。</li>
</ol>
<p><strong>TSM的特定优化</strong></p>
<ol>
<li>数据排序：LSM Tree的数据通常按键排序，而TSM Tree的数据按时间戳排序，专门优化了时间序列数据的存储和查询。这使得TSM在处理时间范围查询和顺序写入时特别高效。</li>
<li>时间片管理：TSM Tree使用时间片来组织数据，每个时间片的数据存储在一个TSM文件中。这种设计进一步优化了时间范围查询的性能，并且有助于时间序列数据的压缩。</li>
<li>数据压缩：TSM文件格式专门设计了多种数据压缩技术，以减少存储空间。这些压缩技术可以更好地处理时间序列数据的特性，如数据点的稀疏性和重复性。</li>
<li>版本控制：TSM支持对同一数据点的多个版本进行存储和管理，通过时间戳进行区分。这在时间序列数据场景中非常有用，因为同一个数据点可能会在不同时间被多次写入。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="最佳实践">最佳实践<a href="#最佳实践" class="hash-link" aria-label="最佳实践的直接链接" title="最佳实践的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-design">schema design<a href="#schema-design" class="hash-link" aria-label="schema design的直接链接" title="schema design的直接链接">​</a></h3>
<p><a href="https://docs.influxdata.com/influxdb/v2/write-data/best-practices/schema-design/" target="_blank" rel="noopener noreferrer">reference</a></p>
<ul>
<li>每个Measurement都是一个描述模式的简单名称。</li>
<li>键在模式中不会重复。即tag key和field key不能重复，如果标签和字段的名称相同，则查询结果可能无法预测。</li>
<li>key不使用保留关键字或特殊字符</li>
<li>使用标签tag来提升查询性能，因为tag会索引，所以将许多数据点所共有的元数据存储为标签可以提升查询性能</li>
<li>使用字段field存储数字数据</li>
<li>使用字段field存储唯一或高度可变的数据。</li>
<li>Measurements and keys不要包含数据，使用tag value和field value存储数据</li>
<li>保存key的简单，不要使用多字段拼接来命名key</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-series-cardinality">high series cardinality<a href="#high-series-cardinality" class="hash-link" aria-label="high series cardinality的直接链接" title="high series cardinality的直接链接">​</a></h3>
<p>先解释一下什么是high series cardinality，首先series的定义是a unique combination of measurement and tag set，所以我理解high series cardinality就是tag set中tag的值不相同的数量太多，导致tag set的排列组合太多。high series cardinality会导致内存飙升和读写效率下降。</p>
<p><a href="https://docs.influxdata.com/influxdb/v2/write-data/best-practices/resolve-high-cardinality/" target="_blank" rel="noopener noreferrer">官方文档</a>中开头就是一句：</p>
<blockquote>
<p>If reads and writes to InfluxDB have started to slow down, high <a href="https://docs.influxdata.com/influxdb/v2/reference/glossary/#series-cardinality" target="_blank" rel="noopener noreferrer">series cardinality</a> (too many series) may be causing memory issues.</p>
</blockquote>
<p><strong>高基数系列的原因</strong></p>
<ul>
<li>标签值的多样性：如果某个标签的可能取值非常多，比如用户ID、设备ID等，这会导致生成大量唯一的标签组合。</li>
<li>标签组合的数量：标签的数量和每个标签的取值范围决定了可能的标签组合数。如果有多个标签，并且每个标签都有很多可能的取值，这会导致非常多的唯一组合。</li>
</ul>
<p><strong>高基数系列的影响</strong></p>
<ul>
<li>内存使用增加：每个唯一的标签组合都会创建一个新的时间序列，需要在内存中维护元数据。</li>
<li>查询性能下降：高基数标签会导致查询需要处理更多的时间序列，增加查询时间。</li>
<li>存储效率降低：高基数时间序列  会增加存储需求，导致磁盘使用效率降低。</li>
<li>数据管理复杂度增加：数据清理、归档等操作变得更加复杂。</li>
</ul>
<p><strong>优化建议</strong></p>
<p>为了减少高基数系列对系统的影响，可以考虑以下优化策略：</p>
<ul>
<li>
<p>减少标签基数：<strong>将高基数标签tag转换为字段field，如果它们不是频繁用于查询和过滤。即增加数据的处理量来减少查询的复杂度。</strong></p>
</li>
<li>
<p>标签聚合：合并或简化标签值，减少唯一组合数量。</p>
</li>
</ul>
<p>​		例如，将 <code>measurement,tag1=a,tag2=b,tag3=c</code> 减少成 <code>measurement,tag1=a,tag2=b</code>。减少标签的数量或者简化标签的值，可以显著降低唯一组合的数量，从而降低系统的负载。</p>
<ul>
<li>分片存储：根据时间或其他低基数标签进行分片，分散存储负载。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flux">Flux<a href="#flux" class="hash-link" aria-label="Flux的直接链接" title="Flux的直接链接">​</a></h2>
<p>InfluxQL和Flux的区别</p>
<blockquote>
<p><strong>InfluxQL</strong>: InfluxDB 早期的查询语言，语法类似于 SQL，允许用户执行查询、聚合、过滤、和操作时间序列数据。它的语法比较简单和熟悉。但它的功能相对有限，特别是在数据处理、复杂分析和跨数据源的查询方面。</p>
<p><strong>Flux</strong>:  InfluxDB 2.x 引入的一种新的查询语言。相比 InfluxQL，Flux 是一种更强大和灵活的语言，允许用户编写更加复杂的查询、进行多维度分析、数据处理和跨多个数据源的操作。Flux 是类似于函数式编程的查询语言，支持更多的数据转换和自定义逻辑。它还支持从 InfluxDB、Prometheus 和其他数据源中检索数据。</p>
<p>Flux 是未来的主推方向，支持更多功能。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flux使用">Flux使用<a href="#flux 使用" class="hash-link" aria-label="Flux使用的直接链接" title="Flux使用的直接链接">​</a></h3>
<p>首先需要安装flux的命令行界面，我的是Mac，操作系统不同安装命令就不一样</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> influxdb-cli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后执行，<code>influx query &#x27;{flux语句}&#x27;</code>，如下所示：</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">influx query </span><span class="token string" style="color:#e3116c">&#x27;from(bucket:&quot;startBucket&quot;) |&gt; range(start:-30m)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Result: _result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Table: keys: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_start, _stop, _field, _measurement, device_id, location</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   _start:time                      _stop:time           _field:string     _measurement:string        device_id:string         location:string                      _time:time                  _value:float</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------  ------------------------------  ----------------------  ----------------------  ----------------------  ----------------------  ------------------------------  ----------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T02:32:14.286925799Z  </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T03:02:14.286925799Z                humidity             sensor_data                   </span><span class="token number" style="color:#36acaa">12347</span><span class="token plain">                cn-south  </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T02:42:53.131000000Z                          </span><span class="token number" style="color:#36acaa">44.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Table: keys: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_start, _stop, _field, _measurement, device_id, location</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   _start:time                      _stop:time           _field:string     _measurement:string        device_id:string         location:string                      _time:time                  _value:float</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------  ------------------------------  ----------------------  ----------------------  ----------------------  ----------------------  ------------------------------  ----------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T02:32:14.286925799Z  </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T03:02:14.286925799Z             temperature             sensor_data                   </span><span class="token number" style="color:#36acaa">12347</span><span class="token plain">                cn-south  </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-13T02:42:53.131000000Z                          </span><span class="token number" style="color:#36acaa">24.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flux数据模型">Flux数据模型<a href="#flux数据模型" class="hash-link" aria-label="Flux数据模型的直接链接" title="Flux数据模型的直接链接">​</a></h3>
<p><a href="https://docs.influxdata.com/flux/v0/" target="_blank" rel="noopener noreferrer">Flux文档</a></p>
<p><a href="https://docs.influxdata.com/influxdb/v2/query-data/get-started/query-influxdb/" target="_blank" rel="noopener noreferrer">influx中使用Flux</a></p>
<p>这个文档里面讲的Flux的查询模型和用法，讲的太好了，虽然是英文的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="语法first-sight">语法first sight<a href="#语法first-sight" class="hash-link" aria-label="语法first sight的直接链接" title="语法first sight的直接链接">​</a></h4>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 从influxdb中查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket: </span><span class="token string" style="color:#e3116c">&quot;example-bucket&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start: -1d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r._measurement </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example-measurement&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> yield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&quot;_results&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 从csv文件中查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">csv.from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file: </span><span class="token string" style="color:#e3116c">&quot;path/to/example/data.csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start: -1d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r._measurement </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example-measurement&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> yield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&quot;_results&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 从数据库查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql.from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driverName: </span><span class="token string" style="color:#e3116c">&quot;postgres&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dataSourceName: </span><span class="token string" style="color:#e3116c">&quot;postgresql://user:password@localhost&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query: </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM TestTable&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r.UserID </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123ABC456DEF&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">column: </span><span class="token string" style="color:#e3116c">&quot;purchase_total&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> yield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name: </span><span class="token string" style="color:#e3116c">&quot;_results&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://docs.influxdata.com/flux/v0/stdlib/influxdata/influxdb/from/" target="_blank" rel="noopener noreferrer"><code>from()</code></a> to retrieve data from the data source.</li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/syntax-basics/#pipe-forward-operator" target="_blank" rel="noopener noreferrer">Pipe-forward operator (<code>|&gt;</code>)</a> to send the output of each function to the next function as input.</li>
<li><a href="https://docs.influxdata.com/flux/v0/stdlib/universe/range/" target="_blank" rel="noopener noreferrer"><code>range()</code></a>, <a href="https://docs.influxdata.com/flux/v0/stdlib/universe/filter/" target="_blank" rel="noopener noreferrer"><code>filter()</code></a>, or both to filter data based on column values.</li>
<li><a href="https://docs.influxdata.com/flux/v0/stdlib/universe/mean/" target="_blank" rel="noopener noreferrer"><code>mean()</code></a> to calculate the average of values returned from the data source.</li>
<li><a href="https://docs.influxdata.com/flux/v0/stdlib/universe/yield/" target="_blank" rel="noopener noreferrer"><code>yield()</code></a> to yield results to the user.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据源概念">数据源概念<a href="#数据源概念" class="hash-link" aria-label="数据源概念的直接链接" title="数据源概念的直接链接">​</a></h4>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/flux-0.png" alt="image" style="max-width:36%;height:auto;display:block;margin:0 auto"></div>
<p>flux中的概念都是抽象概念，influx的存储层和查询层是分开的，之所以flux能查询influx，是influx组件提供了对其语法的解析和底层数据的检索支持。而flux不仅仅是给influx提供查询语法，它是一个通用的查询语言。其中flux得数据源对象包含如下对象：</p>
<ul>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#stream-of-tables" target="_blank" rel="noopener noreferrer">Stream of tables</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#table" target="_blank" rel="noopener noreferrer">Table</a>：A <strong>table</strong> is a collection of <a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#column" target="_blank" rel="noopener noreferrer">columns</a> partitioned by <a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#group-key" target="_blank" rel="noopener noreferrer">group key</a>，即table和mysql的表不一样，这里的table是group key的列组合</li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#column" target="_blank" rel="noopener noreferrer">Column</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#row" target="_blank" rel="noopener noreferrer">Row</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#group-key" target="_blank" rel="noopener noreferrer">Group key</a>：Group key定义使用哪些列对表流中的表进行分组，即<strong>group key 是一个抽象的概念，定义了数据聚合和统计的分组维度，即根据哪些列（字段、标签等）对数据进行分组，它决定了如何将数据拆分成不同的组，每个组可以单独进行进一步的处理或分析，并且每个group key只能定义一个_field。</strong></li>
</ul>
<blockquote>
<p><code>Group key</code>不同于<code>InfluxDB</code> 的 <code>Series Key</code>，Group key更加灵活和广泛，能够适应不同的数据源，它可以包含 fields。 <code>Series Key</code>则是influxdb的存储所以单位，不包含fields。A group key can be represented by an array of column labels.，如下示例：</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_measurement: </span><span class="token string" style="color:#e3116c">&quot;production&quot;</span><span class="token plain">, facility: </span><span class="token string" style="color:#e3116c">&quot;us-midwest&quot;</span><span class="token plain">, _field: </span><span class="token string" style="color:#e3116c">&quot;apq&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_measurement: </span><span class="token string" style="color:#e3116c">&quot;production&quot;</span><span class="token plain">, facility: </span><span class="token string" style="color:#e3116c">&quot;eu-central&quot;</span><span class="token plain">, _field: </span><span class="token string" style="color:#e3116c">&quot;apq&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Group key是个抽象的概念，实际flux语句不能这么写，并且在flux语句中定义数据源，可以不定义measurement，只定义bucket，measurement在filter中定义</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="保留字段">保留字段<a href="#保留字段" class="hash-link" aria-label="保留字段的直接链接" title="保留字段的直接链接">​</a></h4>
<p><strong>Flux</strong> 中，带有下划线（_）的字段通常是保留字段，这些字段有特定的用途和含义</p>
<ol>
<li><strong>_measurement</strong>：指示数据的测量（measurement）名称。它与 <strong>InfluxDB</strong> 的 measurement 概念对应，用于标识数据所属的测量。</li>
<li><strong>_field</strong>：这是 Flux 中一个非常重要的保留字段。它指代数据中的字段名。字段（field）是时间序列数据的实际值，如温度、湿度等。在 Flux 查询中，_field 可以用来进行数据的选择、聚合等操作。</li>
<li><strong>_value</strong>：表示字段的值。在数据表中，字段的值是实际的数值或字符串。这个字段通常用于指定和检索数据的具体值。</li>
<li><strong>_time</strong>：表示时间戳。时间戳用于标记数据的时间点，是时间序列数据的核心部分。</li>
</ol>
<ul>
<li><strong>_start</strong>：表示时间范围的开始时间。</li>
<li><strong>_stop</strong>：表示时间范围的结束时间。</li>
</ul>
<p><strong>_measurement</strong>、<strong>_field</strong> 和 <strong>_time</strong> 是时间序列数据的核心字段，而 <strong>_value</strong> 通常是字段的实际值。</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## InfluxDB 数据点：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measurement: sensor_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location: </span><span class="token string" style="color:#e3116c">&quot;office&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  device: </span><span class="token string" style="color:#e3116c">&quot;sensor1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fields:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature: </span><span class="token number" style="color:#36acaa">22.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  humidity: </span><span class="token number" style="color:#36acaa">55.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time: </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-09-12T12:00:00Z</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># flux查询语句</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket: </span><span class="token string" style="color:#e3116c">&quot;sensor_bucket&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">start</span><span class="token plain">: </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_measurement </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sensor_data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_field </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;temperature&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Filtering by field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;office&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Filtering by tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意：<code>filter(fn: (r) =&gt; r._field == &quot;temperature&quot;</code>) 语句用于筛选数据点中指定字段的记录，而不是过滤值。具体来说，这个过滤操作是根据字段的名称（field key）来筛选数据点。</strong></p>
<p><strong>多字段多过  滤值的语法，多个字段（temperature 和 humidity），在数据处理时，实际上这些字段可以看作是多个 group key 的组成部分。每个字段会生成一个独立的数据组，尽管它们可能共享某些相同的标签。</strong></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket: </span><span class="token string" style="color:#e3116c">&quot;sensor_bucket&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start: -1h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r._measurement </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sensor_data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> r._field </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;temperature&quot;</span><span class="token plain"> or r._field </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;humidity&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r._field </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;temperature&quot;</span><span class="token plain"> and r._value </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r._field </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;humidity&quot;</span><span class="token plain"> and r._value </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="table的转化处理">Table的转化处理<a href="#table的转化处理" class="hash-link" aria-label="Table的转化处理的直接链接" title="Table的转化处理的直接链接">​</a></h4>
<p><strong>在 Flux 中，数据以 table 的形式存储和处理。每个 table 是一个包含多个行的集合，其中的每一行代表一个数据记录。table 可以看作是数据在特定 group key 下的集合，每个 table 对应一个 group key，也就是每个table也只有一个field，包含了所有具有相同 group key 值的数据记录。如果不显式地定义 group()，Flux会为不同的 field 分配到各自的 table。</strong></p>
<p>并且flux在处理表的转化时，各个表是独立处理的，<em>At its core, Flux operates on tables. Flux <a href="https://docs.influxdata.com/flux/v0/function-types/#transformations" target="_blank" rel="noopener noreferrer">transformations</a> take a stream of tables as input, but operate on each table individually.</em>。比如如下图所示：</p>
<div style="text-align:center;width:100%"><img src="/analysis-project/img/influx/flux-1.png" alt="image" style="max-width:36%;height:auto;display:block;margin:0 auto"></div>
<p>如果要自定义group，则使用<code>group()</code>函数来处理，这里的<code>mode</code>是模式，&quot;by&quot; 表示按照指定的列进行分组。还有其他模式，如 &quot;default&quot; 和 &quot;except&quot;</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, mode: </span><span class="token string" style="color:#e3116c">&quot;by&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比如：</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;_time&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;_measurement&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;loc&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;sensorID&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;_field&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;_value&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的columns中每个都可以去掉，而当每去掉一个columns时，group的结果都不一样。在文档中给出了数据的<a href="https://docs.influxdata.com/flux/v0/get-started/data-model/#table-grouping-example" target="_blank" rel="noopener noreferrer">示例</a>。</p>
<blockquote>
<p>当然也可以不定义 <strong>group()</strong> 的查询，如果不使用 group()，Flux 查询会将数据视为一个整体，不进行任何分组。这意味着所有数据将被作为一个单一的组处理，查询结果会是一个单一的 table，其中包含了所有的数据记录。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法规则">语法规则<a href="#语法规则" class="hash-link" aria-label="语法规则的直接链接" title="语法规则的直接链接">​</a></h3>
<p>The majority of basic Flux queries include the following steps:</p>
<ul>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/query-basics/#source" target="_blank" rel="noopener noreferrer">Source</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/query-basics/#filter" target="_blank" rel="noopener noreferrer">Filter</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/query-basics/#shape-data" target="_blank" rel="noopener noreferrer">Shape</a></li>
<li><a href="https://docs.influxdata.com/flux/v0/get-started/query-basics/#process" target="_blank" rel="noopener noreferrer">Process</a></li>
</ul>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;example-bucket&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// ── Source</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">1d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// ── Filter on time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function-variable function" style="color:#d73a49">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_field</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ── Filter on column values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;sensorID&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">// ── Shape</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                               </span><span class="token comment" style="color:#999988;font-style:italic">// ── Process</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-client">Java client<a href="#java-client" class="hash-link" aria-label="Java client的直接链接" title="Java client的直接链接">​</a></h3>
<p>写入数据</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">liufei</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">junit5</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">test</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">influxdbJava</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotations</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Column</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotations</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Measurement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">InfluxDBClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">InfluxDBClientFactory</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">WriteApiBlocking</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">domain</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">WritePrecision</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">write</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Point</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">time</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Instant</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @author liufei</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">InfluxDB2ExampleWrite</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RAf5PzC_ncP9F-bnZt77BgiidkIqv3oJrZB4cuAO5sBwS-wUClqN01zJzj3kGh9nUxGmAE2BqecXCuFyhtRA5w==&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BUCKET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jobBucket&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;liufeiOrg&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">InfluxDBClient</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">InfluxDBClientFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://localhost:8086&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//        writeLineProtocol();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//        writeDataPoint();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">writePOJO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Line Protocol</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writeLineProtocol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 自动关闭流，InfluxDBClient实现了AutoCloseable接口，所以能这么写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InfluxDBClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">String</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;job,location=cd,education=bac salary=16,bonus=13&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">WriteApiBlocking</span><span class="token plain"> writeApi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getWriteApiBlocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeApi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writeRecord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">BUCKET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">WritePrecision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// DataPoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writeDataPoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InfluxDBClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Point</span><span class="token plain"> point </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Point</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">measurement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;job&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addTag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;location&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cd&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addTag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;education&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;master&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;salary&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">23.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bonus&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Instant</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">WritePrecision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">WriteApiBlocking</span><span class="token plain"> writeApi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getWriteApiBlocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeApi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writePoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">BUCKET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> point</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// DataPoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writePOJO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InfluxDBClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Job</span><span class="token plain"> mem </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Job</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cd&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">education </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;master&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bonus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// 可以提交负数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//            mem.time = Instant.now();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mem</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Instant</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ofEpochMilli</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1726312539920L</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// 也可以提交历史时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">WriteApiBlocking</span><span class="token plain"> writeApi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getWriteApiBlocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeApi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writeMeasurement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">BUCKET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">WritePrecision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Measurement名称要写对</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Measurement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;job&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Job</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain">  location</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain">  education</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Float</span><span class="token plain">   salary</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Float</span><span class="token plain">   bonus</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Instant</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>读取数据</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">liufei</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">junit5</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">test</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token namespace" style="opacity:0.7">influxdbJava</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotations</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Column</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">annotations</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Measurement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">InfluxDBClient</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">InfluxDBClientFactory</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">WriteApiBlocking</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">domain</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">WritePrecision</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">client</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">write</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Point</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">query</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FluxRecord</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">com</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">influxdb</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">query</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">FluxTable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">time</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">Instant</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import namespace" style="opacity:0.7">util</span><span class="token import namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token import class-name">List</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @author liufei</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">InfluxDB2ExampleRead</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RAf5PzC_ncP9F-bnZt77BgiidkIqv3oJrZB4cuAO5sBwS-wUClqN01zJzj3kGh9nUxGmAE2BqecXCuFyhtRA5w==&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BUCKET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jobBucket&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token plain">    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;liufeiOrg&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">InfluxDBClient</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">InfluxDBClientFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://localhost:8086&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toCharArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                from(bucket: &quot;jobBucket&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                  |&gt; range(start: -3h, stop: -0h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                  |&gt; filter(fn: (r) =&gt; r[&quot;_measurement&quot;] == &quot;job&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                  |&gt; filter(fn: (r) =&gt; r[&quot;_field&quot;] == &quot;salary&quot; or r[&quot;_field&quot;] == &quot;bonus&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                  |&gt; aggregateWindow(every: 30m, fn: mean, createEmpty: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                  |&gt; yield(name: &quot;mean&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">                &quot;&quot;&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">FluxTable</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> tables</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">InfluxDBClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getQueryApi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">ORG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 返回格式就是FluxTable和FluxRecord，对应的就是influx中的数据点record和列组合table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FluxTable</span><span class="token plain"> table </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> tables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FluxRecord</span><span class="token plain"> record </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getRecords</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getMeasurement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getStart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;_value&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Swagger-Ranger/analysis-project/docs/middleware/influxdb/influxdb手册.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/analysis-project/docs/middleware/disruptor"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Disruptor</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/analysis-project/docs/middleware/kakfa/Kafka手册1-功能"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Kafka手册1-功能</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#版本信息" class="table-of-contents__link toc-highlight">版本信息</a></li><li><a href="#安装部署" class="table-of-contents__link toc-highlight">安装部署</a><ul><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#调整启动参数" class="table-of-contents__link toc-highlight">调整启动参数</a></li><li><a href="#influx-ui" class="table-of-contents__link toc-highlight">influx ui</a></li><li><a href="#influx-cli" class="table-of-contents__link toc-highlight">Influx cli</a><ul><li><a href="#cli命令" class="table-of-contents__link toc-highlight">cli命令</a></li></ul></li><li><a href="#docker部署" class="table-of-contents__link toc-highlight">docker部署</a></li></ul></li><li><a href="#influx核心概念" class="table-of-contents__link toc-highlight">Influx核心概念</a><ul><li><a href="#data-elements" class="table-of-contents__link toc-highlight">data elements</a></li><li><a href="#influxdb数据格式补充" class="table-of-contents__link toc-highlight">influxdb数据格式补充</a></li><li><a href="#influxdb-设计原则" class="table-of-contents__link toc-highlight">InfluxDB 设计原则</a><ul><li><a href="#1按时间升序写入" class="table-of-contents__link toc-highlight">1、按时间升序写入</a></li><li><a href="#2严格的更新和删除权限" class="table-of-contents__link toc-highlight">2、严格的更新和删除权限</a></li><li><a href="#3读写查询优先而不是强一致性" class="table-of-contents__link toc-highlight">3、读写查询优先而不是强一致性</a></li><li><a href="#4无模式设计schemaless-design" class="table-of-contents__link toc-highlight">4、无模式设计（Schemaless design）</a></li><li><a href="#5数据集胜过单个数据datasets-over-individual-points" class="table-of-contents__link toc-highlight">5、数据集胜过单个数据（Datasets over individual points）</a></li><li><a href="#6重复数据" class="table-of-contents__link toc-highlight">6、重复数据</a></li></ul></li><li><a href="#tsmtsi" class="table-of-contents__link toc-highlight">TSM/TSI</a><ul><li><a href="#存储模型" class="table-of-contents__link toc-highlight">存储模型</a></li><li><a href="#文件系统的布局" class="table-of-contents__link toc-highlight">文件系统的布局</a></li><li><a href="#数据模型" class="table-of-contents__link toc-highlight">数据模型</a></li><li><a href="#field的内部处理" class="table-of-contents__link toc-highlight">field的内部处理</a></li><li><a href="#检索优化" class="table-of-contents__link toc-highlight">检索优化</a></li><li><a href="#与-lsm的区别" class="table-of-contents__link toc-highlight">与 LSM的区别</a></li></ul></li></ul></li><li><a href="#最佳实践" class="table-of-contents__link toc-highlight">最佳实践</a><ul><li><a href="#schema-design" class="table-of-contents__link toc-highlight">schema design</a></li><li><a href="#high-series-cardinality" class="table-of-contents__link toc-highlight">high series cardinality</a></li></ul></li><li><a href="#flux" class="table-of-contents__link toc-highlight">Flux</a><ul><li><a href="#flux使用" class="table-of-contents__link toc-highlight">Flux使用</a></li><li><a href="#flux数据模型" class="table-of-contents__link toc-highlight">Flux数据模型</a><ul><li><a href="#语法first-sight" class="table-of-contents__link toc-highlight">语法first sight</a></li><li><a href="#数据源概念" class="table-of-contents__link toc-highlight">数据源概念</a></li><li><a href="#保留字段" class="table-of-contents__link toc-highlight">保留字段</a></li><li><a href="#table的转化处理" class="table-of-contents__link toc-highlight">Table的转化处理</a></li></ul></li><li><a href="#语法规则" class="table-of-contents__link toc-highlight">语法规则</a></li><li><a href="#java-client" class="table-of-contents__link toc-highlight">Java client</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Analysis Project, author liufei32@outlook.com</div></div></div></footer></div>
</body>
</html>